<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜“å®‰ç¶² e-Insure | æ¥­å‹™åˆ¶åº¦æˆ°ç•¥æ¨¡æ“¬ç³»çµ± V28</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f172a;       
            --bg-panel: #1e293b;      
            --border-color: #334155;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --color-personal: #38bdf8; 
            --color-team: #fb923c;     
            --color-accent: #6366f1;   
            --color-ai: #d946ef;       
            --color-success: #10b981;  
            --color-warning: #f59e0b;  
            --color-danger: #ef4444;   
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Inter', "Microsoft JhengHei", sans-serif;
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
            margin: 0;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 360px;
            background-color: #020617;
            border-right: 1px solid var(--border-color);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 4px 0 20px rgba(0,0,0,0.5);
        }
        
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-track { background: #0f172a; }
        .sidebar::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* --- Main Content --- */
        .main-content {
            margin-left: 360px;
            flex-grow: 1;
            padding: 30px 40px;
            background-image: radial-gradient(circle at top right, #1e293b 0%, transparent 40%);
        }

        /* --- Tabs Styling --- */
        .nav-tabs { border-bottom: 1px solid var(--border-color); margin-bottom: 25px; }
        .nav-tabs .nav-link {
            color: var(--text-sub);
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 1rem;
            font-weight: 600;
            padding: 10px 20px;
            transition: all 0.3s;
        }
        .nav-tabs .nav-link:hover { color: white; }
        .nav-tabs .nav-link.active {
            color: var(--color-personal);
            background: transparent;
            border-bottom: 3px solid var(--color-personal);
        }
        .tab-content { animation: fadeIn 0.5s ease-out; }

        /* --- UI Elements --- */
        .section-header {
            font-size: 0.8rem; font-weight: 800; color: var(--color-accent);
            text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px;
        }

        .custom-select {
            background-color: #1e293b; border: 1px solid #475569; color: white;
            border-radius: 8px; padding: 12px; width: 100%; font-size: 0.95rem;
            cursor: pointer; transition: all 0.3s;
        }
        .custom-select:focus { border-color: var(--color-personal); outline: none; }
        
        .range-block { margin-bottom: 20px; }
        .range-label { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-sub); margin-bottom: 8px; }
        .range-val { font-family: 'JetBrains Mono', monospace; font-weight: bold; color: var(--color-personal); font-size: 1rem; }
        
        input[type=range] {
            width: 100%; height: 6px; background: #334155; border-radius: 5px;
            outline: none; -webkit-appearance: none; cursor: pointer;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px;
            background: var(--color-personal); border-radius: 50%;
            border: 2px solid #fff; box-shadow: 0 0 10px var(--color-personal);
        }

        .def-box {
            background: rgba(99, 102, 241, 0.1);
            border-left: 3px solid var(--color-accent);
            padding: 12px; margin-bottom: 15px; border-radius: 0 8px 8px 0;
            font-size: 0.8rem; color: #cbd5e1; line-height: 1.5;
        }
        .def-tag { background: var(--color-accent); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-right: 5px; }

        /* --- Right Panel Components --- */
        .alert-box {
            background: rgba(245, 158, 11, 0.1); 
            border: 1px solid var(--color-warning);
            border-radius: 12px; padding: 20px; margin-bottom: 25px; 
            display: none; 
            animation: fadeIn 0.5s ease-out;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.1);
        }
        .alert-title { color: var(--color-warning); font-weight: 800; font-size: 1.1rem; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .alert-desc { color: #e2e8f0; font-size: 0.95rem; line-height: 1.6; }

        .ai-card {
            background: linear-gradient(135deg, rgba(217, 70, 239, 0.15), rgba(124, 58, 237, 0.1));
            border: 1px solid rgba(217, 70, 239, 0.4);
            border-radius: 16px; padding: 20px; margin-bottom: 30px;
            display: flex; gap: 20px; align-items: start;
            box-shadow: 0 0 25px rgba(217, 70, 239, 0.15);
            transition: all 0.3s;
        }
        .ai-icon {
            width: 48px; height: 48px; background: var(--color-ai); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; color: white; flex-shrink: 0;
            box-shadow: 0 0 15px var(--color-ai);
        }
        .ai-content h5 { color: var(--color-ai); font-weight: 800; margin: 0 0 8px 0; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .ai-text { color: #f1f5f9; font-size: 1rem; line-height: 1.6; font-weight: 500; }

        .kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .kpi-card { 
            background: var(--bg-panel); border: 1px solid var(--border-color); 
            border-radius: 12px; padding: 20px; position: relative; overflow: hidden;
        }
        .kpi-card.growth { border-color: rgba(56, 189, 248, 0.6); box-shadow: 0 0 15px rgba(56, 189, 248, 0.1); }
        
        .kpi-title { font-size: 0.85rem; font-weight: 700; color: #cbd5e1; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; }
        .kpi-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-sub); }
        .kpi-row.highlight { margin-top: 15px; padding-top: 10px; border-top: 1px dashed #475569; font-weight: 800; font-size: 1.2rem; color: white; }
        
        .val-p { color: var(--color-personal); font-family: 'JetBrains Mono'; }
        .val-t { color: var(--color-team); font-family: 'JetBrains Mono'; }
        .val-tot { color: white; font-family: 'JetBrains Mono'; }

        .leverage-box { background: linear-gradient(145deg, #1e293b, #0f172a); border: 1px solid #475569; border-radius: 16px; padding: 30px; margin-bottom: 30px; }
        .lev-grid { display: grid; grid-template-columns: 1fr 180px 1fr; gap: 20px; align-items: center; }
        .lev-col { 
            text-align: center; background: rgba(255,255,255,0.02); 
            border-radius: 10px; padding: 20px; height: 100%; 
            display: flex; flex-direction: column; justify-content: center; 
        }
        .lev-value { font-size: 1.8rem; font-weight: 800; color: white; font-family: 'JetBrains Mono'; margin-bottom: 5px; }
        .lev-circle { 
            width: 140px; height: 140px; border-radius: 50%; background: #020617; 
            border: 4px solid var(--color-success); margin: 0 auto; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            box-shadow: 0 0 25px rgba(16, 185, 129, 0.3); 
        }
        .lev-x { font-size: 2.5rem; font-weight: 900; color: var(--color-success); font-family: 'JetBrains Mono'; line-height: 1; }

        .bottom-section { display: grid; grid-template-columns: 1.8fr 1fr; gap: 20px; }
        .panel { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        
        .table-custom { width: 100%; font-size: 0.9rem; color: var(--text-sub); border-collapse: collapse; }
        .table-custom th { padding: 12px; color: white; border-bottom: 1px solid var(--border-color); text-align: right; font-weight: 600; }
        .table-custom th:first-child { text-align: center; }
        .table-custom td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: 'JetBrains Mono'; text-align: right; }
        .table-custom td:first-child { text-align: center; color: var(--text-sub); }

        /* Rule Cards for Tab 2 */
        .rule-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .rule-title { font-size: 1.1rem; font-weight: 700; color: var(--color-personal); margin-bottom: 15px; border-left: 4px solid var(--color-personal); padding-left: 10px; }
        .rule-table { width: 100%; font-size: 0.9rem; border-collapse: collapse; }
        .rule-table th { background: rgba(56, 189, 248, 0.1); color: white; padding: 10px; border: 1px solid var(--border-color); text-align: center; }
        .rule-table td { padding: 10px; border: 1px solid var(--border-color); text-align: center; color: var(--text-sub); }
        .formula-box { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; font-family: 'JetBrains Mono'; border: 1px dashed var(--border-color); color: var(--color-warning); margin-top: 10px; }

        @keyframes fadeIn { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }

        @media (max-width: 1200px) {
            .kpi-grid { grid-template-columns: 1fr; }
            .lev-grid { grid-template-columns: 1fr; gap: 30px; }
            .bottom-section { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="mb-4">
        <h4 class="fw-bold m-0 text-white"><i class="fas fa-shield-alt me-2 text-primary"></i>æ˜“å®‰ç¶² e-Insure</h4>
        <small class="text-white opacity-50" style="letter-spacing: 1px;">åˆ¶åº¦æ¨¡æ“¬ç³»çµ± V28</small>
    </div>

    <div class="def-box">
        <div><span class="def-tag">TFYB</span> <strong>åƒæ•¸å®šç¾©ï¼š</strong></div>
        æœ¬ç³»çµ±æ•¸å€¼ç‚º <strong>TFYB (FYB x 90%)</strong>ã€‚<br>
        ä¾æ“šæ‰‹å†Šè¦å®šï¼Œå„é …çé‡‘ç™¼æ”¾çš†ä»¥æ­¤ç‚ºè¨ˆç®—åŸºç¤ã€‚
    </div>

    <div>
        <div class="section-header"><i class="fas fa-chess-knight"></i> æ¨è¼”æˆ°ç•¥</div>
        <select class="custom-select" id="strategySelect" onchange="calculate()">
            <option value="A" selected>ğŸ›¡ï¸ æ¨è¼”åˆä¸€ (100% å®Œæ•´è¼”å°)</option>
            <option value="B">ğŸ¤ æ¨è¼”åˆ†é–‹ (30% æ¨è–¦åˆ©ç›Š)</option>
        </select>
        <div class="mt-2 small text-sub" style="font-size: 0.75rem;">
            * ç­–ç•¥ B æ¨¡æ“¬ã€Œç´”æ¨è–¦ä¸è¼”å°ã€æˆ–ã€ŒåŒå€ä½å¢é«˜ã€æƒ…å¢ƒï¼Œåˆ©æ½¤ç‚ºé¦–å¹´åº¦çµ„ç¹”çé‡‘ä¹‹ 30%ã€‚
        </div>
    </div>

    <hr class="border-secondary opacity-25">

    <div>
        <div class="section-header"><i class="fas fa-user-tag"></i> è·ç´šè¨­å®š</div>
        
        <div class="row g-2">
            <div class="col-6">
                <label class="small text-sub mb-1">æ‚¨çš„è·ç´š</label>
                <select id="myRank" class="custom-select" onchange="calculate()">
                    <option value="0.92">VP æ¥­å‹™å‰¯ç¸½ (92%)</option>
                    <option value="0.90">AVP æ¥­å‹™å”ç† (90%)</option>
                    <option value="0.83" selected>SBD æ¥­å‹™ç¸½ç›£ (83%)</option>
                    <option value="0.75">UM ç¶“ç† (75%)</option>
                    <option value="0.70">BAS æ¥­å‹™å‰¯ç† (70%)</option>
                    <option value="0.60">AG æ¥­å‹™å°ˆå“¡ (60%)</option>
                </select>
            </div>
            <div class="col-6">
                <label class="small text-sub mb-1">åœ˜éšŠè·ç´š</label>
                <select id="subRank" class="custom-select" onchange="calculate()">
                    <option value="0.92">VP æ¥­å‹™å‰¯ç¸½ (92%)</option>
                    <option value="0.90">AVP æ¥­å‹™å”ç† (90%)</option>
                    <option value="0.83">SBD æ¥­å‹™ç¸½ç›£ (83%)</option>
                    <option value="0.75">UM ç¶“ç† (75%)</option>
                    <option value="0.70">BAS æ¥­å‹™å‰¯ç† (70%)</option>
                    <option value="0.60" selected>AG æ¥­å‹™å°ˆå“¡ (60%)</option>
                </select>
            </div>
        </div>
    </div>

    <hr class="border-secondary opacity-25">

    <div>
        <div class="section-header"><i class="fas fa-chart-pie"></i> å•†å“é…ç½® (é•·/çŸ­å¹´æœŸ)</div>
        <select class="custom-select" id="productMix" onchange="calculate()">
            <option value="1.0">100% é•·å¹´æœŸ (ä»£æ•¸4%)</option>
            <option value="0.8">80% é•· + 20% çŸ­</option>
            <option value="0.5">50% é•· + 50% çŸ­</option>
            <option value="0.2">20% é•· + 80% çŸ­</option>
            <option value="0.0">100% çŸ­å¹´æœŸ (ä»£æ•¸2%)</option>
        </select>
        <div class="small text-sub" style="font-size: 0.75rem;">
            * ä¾æ‰‹å†Š P.9ï¼šé•·å¹´æœŸä»£æ•¸çé‡‘ 4%ï¼ŒçŸ­å¹´æœŸ/æŠ•è³‡å‹/ç”¢éšª 2%ã€‚
        </div>
    </div>

    <hr class="border-secondary opacity-25">

    <div>
        <div class="section-header"><i class="fas fa-sliders-h"></i> æ¥­ç¸¾åƒæ•¸ (TFYB)</div>
        
        <div class="range-block">
            <div class="range-label"><span>å€‹äºº TFYB</span><span class="range-val" id="valSales">$100,000</span></div>
            <input type="range" id="sliderSales" min="1" max="500" value="10" step="1" oninput="calculate()">
        </div>

        <div class="range-block">
            <div class="range-label"><span>åœ˜éšŠå¹³å‡ TFYB</span><span class="range-val" id="valTeamSales">$50,000</span></div>
            <input type="range" id="sliderTeamSales" min="1" max="500" value="5" step="1" oninput="calculate()">
        </div>

        <div class="range-block">
            <div class="range-label"><span>åœ˜éšŠäººæ•¸</span><span class="range-val" id="valRecruits">3 äºº</span></div>
            <input type="range" id="sliderRecruits" min="0" max="100" value="3" oninput="calculate()">
        </div>

        <div class="range-block">
            <div class="range-label"><span>çºŒä¿ç‡ (Kå€¼)</span><span class="range-val" id="valRetention">90%</span></div>
            <input type="range" id="sliderRetention" min="50" max="100" value="90" oninput="calculate()">
        </div>
    </div>

    <div class="mt-auto pt-3 border-top border-secondary border-opacity-25 small text-sub" style="font-size:0.7rem; line-height:1.6;">
        è³‡æ–™ä¾†æºï¼šæ˜“å®‰ç¶²åˆ¶åº¦æ‰‹å†Š 2024ç‰ˆ<br>
        æ‰‹å†Š P.8 è¡ŒéŠ·/çµ„ç¹”çé‡‘è¡¨ & P.9 ä»£æ•¸çé‡‘
    </div>
</div>

<div class="main-content">

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="sim-tab" data-bs-toggle="tab" data-bs-target="#tab-simulator" type="button" role="tab"><i class="fas fa-calculator me-2"></i>æˆ°ç•¥æ¨¡æ“¬</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="rules-tab" data-bs-toggle="tab" data-bs-target="#tab-rules" type="button" role="tab"><i class="fas fa-book me-2"></i>åˆ¶åº¦ç™¾ç§‘èˆ‡å…¬å¼</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        
        <div class="tab-pane fade show active" id="tab-simulator" role="tabpanel">
            
            <div id="splitAlert" class="alert-box">
                <div class="alert-title">
                    <i class="fas fa-exclamation-triangle"></i> åˆ¶åº¦è­¦ç¤ºï¼šå•Ÿå‹•ã€Œæ¨è¼”åˆ†é–‹ã€è¨ˆç®— (æ‰‹å†Š P.10)
                </div>
                <div class="alert-desc">
                    åµæ¸¬åˆ° <strong>å¹³éšå¢å“¡ (è·ç´šç›¸åŒ)</strong> æˆ– <strong>ä½éšå¢é«˜éš</strong> ç‹€æ³ã€‚<br>
                    ä¾æ“šåˆ¶åº¦æ‰‹å†Šè¦å®šï¼Œæ‚¨çš„æ¬Šç›Šå°‡è½‰ç‚ºã€Œæ¨è–¦äººã€èº«åˆ†ï¼š<br>
                    <span style="color:white; font-weight:bold; background:rgba(255,255,255,0.1); padding:2px 5px; border-radius:4px;">
                        åƒ…é ˜å–é¦–å¹´åº¦çµ„ç¹”çé‡‘ä¹‹ 30%ï¼Œæˆ–ä¾è¦å®šé ˜å–ä»£æ•¸çé‡‘ã€‚
                    </span>
                </div>
            </div>

            <div class="ai-card">
                <div class="ai-icon"><i class="fas fa-robot"></i></div>
                <div class="ai-content">
                    <h5>HEBORN AI æˆ°ç•¥é¡§å•</h5>
                    <div class="ai-text" id="aiAdvice">
                        æ­£åœ¨åˆ†ææ‚¨çš„çµ„ç¹”æ•¸æ“š...
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <h4 class="fw-bold text-white m-0">æ”¶ç›Šé æ¸¬çŸ©é™£ (REVENUE MATRIX)</h4>
                <span class="text-sub small">å«é¦–å¹´åº¦ä½£é‡‘(FYC)ã€çµ„ç¹”åˆ©å·®ã€ä»£æ•¸çé‡‘åŠåŠ æ¬ŠçºŒæœŸåˆ©ç›Š (å–®ä½: æ–°å°å¹£/å…ƒ)</span>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-title"><span>ç¬¬ 1 å¹´ (Start)</span><i class="fas fa-flag text-white opacity-25"></i></div>
                    <div class="kpi-row"><span>å€‹äººæ”¶å…¥</span><span class="val-p" id="y1_self">$0</span></div>
                    <div class="kpi-row"><span>çµ„ç¹”åˆ©æ½¤</span><span class="val-t" id="y1_team">$0</span></div>
                    <div class="kpi-row highlight"><span>å¹´åº¦ç¸½åˆ</span><span class="val-tot" id="y1_total">$0</span></div>
                </div>
                <div class="kpi-card growth">
                    <div class="kpi-title"><span style="color:var(--color-personal)">ç¬¬ 5 å¹´ (Growth)</span><i class="fas fa-chart-line text-primary opacity-50"></i></div>
                    <div class="kpi-row"><span>å€‹äººç´¯ç©</span><span class="val-p" id="y5_self">$0</span></div>
                    <div class="kpi-row"><span>çµ„ç¹”ç´¯ç©</span><span class="val-t" id="y5_team">$0</span></div>
                    <div class="kpi-row highlight"><span>ç´¯ç©ç¸½åˆ</span><span class="val-tot" id="y5_total">$0</span></div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title"><span>ç¬¬ 10 å¹´ (Legacy)</span><i class="fas fa-crown text-warning opacity-50"></i></div>
                    <div class="kpi-row"><span>å€‹äººç´¯ç©</span><span class="val-p" id="y10_self">$0</span></div>
                    <div class="kpi-row"><span>çµ„ç¹”ç´¯ç©</span><span class="val-t" id="y10_team">$0</span></div>
                    <div class="kpi-row highlight"><span>ç´¯ç©ç¸½åˆ</span><span class="val-tot" id="y10_total">$0</span></div>
                </div>
            </div>

            <div class="mb-3">
                <h4 class="fw-bold text-white m-0">åˆ¶åº¦æ§“æ¡¿åˆ†æ (SYSTEM LEVERAGE)</h4>
                <span class="text-sub small">æ¯”è¼ƒã€Œæ¨è¼”åˆä¸€ã€èˆ‡ã€Œæ¨è¼”åˆ†é–‹ã€ä¹‹çµ„ç¹”æ•ˆç›Š</span>
            </div>

            <div class="leverage-box">
                <div class="lev-grid">
                    <div class="lev-col">
                        <div class="lev-title" style="color:#94a3b8; font-size:0.9rem; margin-bottom:10px;">ğŸ›¡ï¸ æ¨è¼”åˆä¸€ (Strategy A)</div>
                        <div class="lev-value" id="lev_val_A">$0</div>
                        <div class="small text-success" style="font-size:0.8rem;">
                            <i class="fas fa-check me-1"></i>100% å®Œæ•´åˆ©å·®<br>
                            <i class="fas fa-check me-1"></i>äº«æœ‰ä»£æ•¸èˆ‡çºŒæœŸ
                        </div>
                    </div>
                    <div class="lev-circle">
                        <div class="lev-x" id="lev_multiplier">0.0x</div>
                        <div class="small text-white mt-2" style="opacity:0.8">æ§“æ¡¿å€æ•¸</div>
                    </div>
                    <div class="lev-col">
                        <div class="lev-title" style="color:#94a3b8; font-size:0.9rem; margin-bottom:10px;">ğŸ¤ æ¨è¼”åˆ†é–‹ (Strategy B)</div>
                        <div class="lev-value" id="lev_val_B">$0</div>
                        <div class="small text-sub" style="font-size:0.8rem;">
                            <i class="fas fa-info-circle me-1"></i>30% æ¨è–¦åˆ©å·®<br>
                            <i class="fas fa-info-circle me-1"></i>åƒ…é¦–å¹´çµ„ç¹”åˆ©ç›Š
                        </div>
                    </div>
                </div>
            </div>

            <div class="bottom-section">
                <div class="panel">
                    <div style="height: 380px; width: 100%;">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
                <div class="panel" style="overflow-y:auto; max-height:420px;">
                    <table class="table-custom">
                        <thead>
                            <tr>
                                <th>å¹´ (Year)</th>
                                <th>å€‹äººæ”¶å…¥</th>
                                <th>åœ˜éšŠåˆ©æ½¤</th>
                                <th>å¹´åº¦ç¸½å’Œ</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-rules" role="tabpanel">
            
            <div class="rule-card">
                <div class="rule-title">ä¸€ã€å„è·ç´šç°¡ç¨±èˆ‡çé‡‘ä¿‚æ•¸ (æ‰‹å†Š P.6, P.8)</div>
                <table class="rule-table">
                    <thead>
                        <tr>
                            <th>è·ç´š (Rank)</th>
                            <th>ç°¡ç¨±</th>
                            <th>ä½£é‡‘ä¿‚æ•¸ (TFYB%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>æ¥­å‹™å‰¯ç¸½</td><td>VP</td><td style="color:var(--color-success); font-weight:bold;">92%</td></tr>
                        <tr><td>æ¥­å‹™å”ç†</td><td>AVP</td><td style="color:var(--color-success);">90%</td></tr>
                        <tr><td>æ¥­å‹™ç¸½ç›£</td><td>SBD</td><td>83%</td></tr>
                        <tr><td>ç¶“ç†</td><td>UM</td><td>75%</td></tr>
                        <tr><td>æ¥­å‹™å‰¯ç†</td><td>BAS</td><td>70%</td></tr>
                        <tr><td>æ¥­å‹™å°ˆå“¡</td><td>AG</td><td>60%</td></tr>
                    </tbody>
                </table>
                <div class="formula-box">
                    é¦–å¹´åº¦è¡ŒéŠ·çé‡‘ = TFYB Ã— å„è·ç´šä½£é‡‘ä¿‚æ•¸<br>
                    <small style="color:var(--text-sub)">* TFYB = FYB Ã— 90%</small>
                </div>
            </div>

            <div class="rule-card">
                <div class="rule-title">äºŒã€çµ„ç¹”çé‡‘è¨ˆç®—é‚è¼¯ (æ‰‹å†Š P.10)</div>
                <div style="color:var(--text-main); line-height:1.8; font-size:0.95rem;">
                    <strong>1. ç´šå·®çé‡‘ (æ¨è¼”åˆä¸€)ï¼š</strong><br>
                    ç•¶ä¸Šç·šè·ç´š > ä¸‹ç·šè·ç´šï¼Œä¸”ç‚ºç›´è½„è¼”å°é—œä¿‚ã€‚<br>
                    <div class="formula-box" style="color:var(--color-personal);">
                        ç´šå·®çé‡‘ = (ä¸Šç·šä¿‚æ•¸% - ä¸‹ç·šä¿‚æ•¸%) Ã— ä¸‹ç·šåœ˜éšŠ TFYB
                    </div>
                    <br>
                    <strong>2. æ¨è–¦åˆ©ç›Š (æ¨è¼”åˆ†é–‹/åŒéš)ï¼š</strong><br>
                    ç•¶ç™¼ç”Ÿã€Œè·¨å€å¢å“¡ã€ã€ã€ŒåŒéšå¢å“¡ã€æˆ–ã€Œä½å¢é«˜ã€æ™‚ï¼Œå•Ÿå‹•åˆ†é–‹è¨ˆç®—ã€‚<br>
                    <div class="formula-box" style="color:var(--color-warning);">
                        æ¨è–¦åˆ©ç›Š = é¦–å¹´åº¦çµ„ç¹”çé‡‘ Ã— 30%
                    </div>
                </div>
            </div>

            <div class="rule-card">
                <div class="rule-title">ä¸‰ã€ä»£æ•¸çé‡‘ (Generation Bonus) (æ‰‹å†Š P.9)</div>
                <div style="margin-bottom:10px; color:var(--text-sub); font-size:0.9rem;">
                    ç•¶ä¸‹å±¬æ™‰å‡è‡³åŒè·ç´šæˆ–è„«é›¢æ™‚ï¼Œæ”¹é ˜å–ä»£æ•¸çé‡‘ã€‚
                </div>
                <table class="rule-table">
                    <thead>
                        <tr>
                            <th>ä»£æ•¸</th>
                            <th>é•·å¹´æœŸå£½éšª (ç¹³è²»â‰¥5å¹´)</th>
                            <th>çŸ­å¹´æœŸ/æŠ•è³‡å‹/ç”¢éšª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>ç¬¬ä¸€ä»£</td><td style="color:var(--color-success); font-weight:bold;">4%</td><td>2%</td></tr>
                        <tr><td>ç¬¬äºŒä»£</td><td>1%</td><td>-</td></tr>
                    </tbody>
                </table>
                <div class="formula-box">
                    ä»£æ•¸çé‡‘ = è©²ä»£åœ˜éšŠç¸½ TFYB Ã— å°æ‡‰%æ•¸
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    let myChart = null;

    function calculate() {
        // --- 1. è®€å–è¼¸å…¥å€¼ ---
        const strategyInput = document.getElementById('strategySelect').value;
        const mixRatio = parseFloat(document.getElementById('productMix').value); 
        
        const myRankVal = Number(document.getElementById('myRank').value);
        const subRankVal = Number(document.getElementById('subRank').value);
        
        const selfSalesRaw = Number(document.getElementById('sliderSales').value);
        const teamSalesRaw = Number(document.getElementById('sliderTeamSales').value);
        const recruits = Number(document.getElementById('sliderRecruits').value);
        const retentionRaw = Number(document.getElementById('sliderRetention').value);

        // å–®ä½è½‰æ›
        const selfTFYB = selfSalesRaw * 10000;
        const teamTFYB = teamSalesRaw * 10000;
        const retentionRate = retentionRaw / 100;

        // UI æ•¸å€¼æ›´æ–°
        document.getElementById('valSales').innerText = `$${selfTFYB.toLocaleString()}`;
        document.getElementById('valTeamSales').innerText = `$${teamTFYB.toLocaleString()}`;
        document.getElementById('valRecruits').innerText = `${recruits} äºº`;
        document.getElementById('valRetention').innerText = `${retentionRaw}%`;
        
        // --- 2. æ ¸å¿ƒé‚è¼¯ (æ‰‹å†Šæ ¡æº–) ---
        let isSplitForced = false;
        let effectiveStrategy = strategyInput;
        
        // è¦å‰‡ (æ‰‹å†Š P.10/P.8 è¨»2)ï¼šè‹¥ä¸‹å±¬è·ç´š >= è‡ªå·±ï¼Œå¼·åˆ¶å•Ÿå‹•ã€Œæ¨è¼”åˆ†é–‹ã€(æ¨è–¦äºº 30%)
        if (subRankVal >= myRankVal) {
            isSplitForced = true;
            effectiveStrategy = 'B';
            document.getElementById('splitAlert').style.display = 'block'; 
        } else {
            document.getElementById('splitAlert').style.display = 'none';
        }

        // å•†å“é…ç½®åŠ æ¬Šä»£æ•¸çé‡‘ (æ‰‹å†Š P.9)
        const shortRatio = 1 - mixRatio;
        const gen1Rate = (mixRatio * 0.04) + (shortRatio * 0.02); 
        const gen2Rate = (mixRatio * 0.01) + (shortRatio * 0.00); 

        // è¨ˆç®—ç´šå·® (Spread)
        let spreadRate = 0;
        if (isSplitForced) {
            spreadRate = 0; 
        } else {
            spreadRate = Math.max(0, myRankVal - subRankVal);
        }

        // --- 3. æ¨¡æ“¬é‹ç®—å‡½æ•¸ ---
        function runSimulation(strat, isForced) {
            let accSelf = 0, accTeam = 0;
            let result = [];

            for (let year = 1; year <= 10; year++) {
                // A. å€‹äººæ”¶å…¥ (FYC + çºŒæœŸ)
                let selfFYC = selfTFYB * myRankVal;
                let selfRenew = 0;
                
                if (year > 1 && mixRatio > 0) {
                    for (let p = 1; p < year; p++) {
                        if (year - p <= 6) { 
                            selfRenew += (selfTFYB * mixRatio * 0.10 * myRankVal * Math.pow(retentionRate, year - p));
                        }
                    }
                }
                let currentSelf = selfFYC + selfRenew;
                accSelf += currentSelf;

                // B. åœ˜éšŠåˆ©æ½¤ (çµ„ç¹”çé‡‘ + ä»£æ•¸)
                let teamVolume = teamTFYB * recruits;
                let spreadBonus = 0;
                let genBonus = 0;

                // ç‹€æ³ 1: æœ‰ç´šå·® (æ­£å¸¸è¼”å°)
                if (!isSplitForced) {
                    spreadBonus = teamVolume * spreadRate;
                    if (strat === 'B') {
                        spreadBonus = spreadBonus * 0.30;
                    }
                }

                // ç‹€æ³ 2: ä»£æ•¸çé‡‘
                if (isSplitForced) {
                    genBonus = teamVolume * gen1Rate;
                    let indirectVolume = teamVolume * 0.5;
                    genBonus += indirectVolume * gen2Rate;
                }

                // åœ˜éšŠçºŒæœŸåˆ©ç›Š
                let teamRenew = 0;
                if (strat === 'A' && !isForced && year > 1 && mixRatio > 0) {
                    for (let p = 1; p < year; p++) {
                        if (year - p <= 6) {
                            teamRenew += (teamVolume * mixRatio * 0.02 * Math.pow(retentionRate, year - p));
                        }
                    }
                }

                let currentTeam = spreadBonus + genBonus + teamRenew;
                accTeam += currentTeam;

                result.push({
                    year: year,
                    self: currentSelf,
                    team: currentTeam,
                    total: currentSelf + currentTeam,
                    accSelf: accSelf,
                    accTeam: accTeam,
                    accTotal: accSelf + accTeam
                });
            }
            return result;
        }

        // åŸ·è¡Œé‹ç®—
        const dataCurrent = runSimulation(effectiveStrategy, isSplitForced);
        
        let dataA, dataB;
        if (isSplitForced) {
            dataA = [{ accTeam: 0 },{},{},{},{},{},{},{},{},{ accTeam: 0 }];
            dataB = runSimulation('B', true); 
        } else {
            dataA = runSimulation('A', false);
            dataB = runSimulation('B', false);
        }

        // --- 4. æ›´æ–° UI ---
        const fmt = (n) => '$' + Math.round(n).toLocaleString();
        
        document.getElementById('y1_self').innerText = fmt(dataCurrent[0].self);
        document.getElementById('y1_team').innerText = fmt(dataCurrent[0].team);
        document.getElementById('y1_total').innerText = fmt(dataCurrent[0].total);

        document.getElementById('y5_self').innerText = fmt(dataCurrent[4].accSelf);
        document.getElementById('y5_team').innerText = fmt(dataCurrent[4].accTeam);
        document.getElementById('y5_total').innerText = fmt(dataCurrent[4].accTotal);

        document.getElementById('y10_self').innerText = fmt(dataCurrent[9].accSelf);
        document.getElementById('y10_team').innerText = fmt(dataCurrent[9].accTeam);
        document.getElementById('y10_total').innerText = fmt(dataCurrent[9].accTotal);

        const totalA = dataA[9].accTeam || 0;
        const totalB = dataB[9].accTeam || 0;
        
        document.getElementById('lev_val_A').innerText = fmt(totalA);
        document.getElementById('lev_val_B').innerText = fmt(totalB);
        
        let multiplier = 0;
        if (totalB > 0) multiplier = (totalA / totalB).toFixed(1);
        else if (totalA > 0) multiplier = "âˆ";
        else multiplier = "0.0";
        document.getElementById('lev_multiplier').innerText = multiplier + "x";

        // AI å»ºè­°
        updateAIAdvice(effectiveStrategy, mixRatio, recruits, isSplitForced, myRankVal, subRankVal);

        // æ›´æ–°åœ–è¡¨èˆ‡è¡¨æ ¼
        updateTableChart(dataCurrent);
    }

    function updateAIAdvice(strategy, mix, recruits, isForced, myRank, subRank) {
        let advice = "";
        
        if (isForced) {
            advice = `âš ï¸ <span style="color:#f59e0b">åˆ¶åº¦è­¦ç¤ºï¼š</span>ç›®å‰è™•æ–¼ã€Œå¹³éš/ä½å¢é«˜ã€ç‹€æ…‹ã€‚<br>ä¾æ‰‹å†Šè¦å®šï¼Œæ‚¨åƒ…èƒ½é ˜å– 30% æ¨è–¦åˆ©ç›Šæˆ–ä»£æ•¸çé‡‘ (é•·å¹´æœŸ4%)ã€‚<br><strong>æˆ°ç•¥å»ºè­°ï¼š</strong>ç›¡é€Ÿæå‡å€‹äººè·ç´šè‡³é«˜æ–¼ä¸‹å±¬ï¼Œæ‰èƒ½æ¢å¾© 100% å®Œæ•´çµ„ç¹”åˆ©ç›Šã€‚`;
        } else if (strategy === 'B') {
            advice = `â„¹ï¸ <span style="color:#38bdf8">æ¨è¼”åˆ†é–‹æ¨¡å¼ï¼š</span>æ‚¨é¸æ“‡åªé ˜å– 30% æ¨è–¦åˆ©ç›Šã€‚<br>é›–ç„¶è²¬ä»»è¼ƒè¼•ï¼Œä½†é•·æœŸå°‡æå¤± 70% çš„çµ„ç¹”æ”¶ç›Šèˆ‡çºŒæœŸè³‡ç”¢ã€‚<br><strong>æˆ°ç•¥å»ºè­°ï¼š</strong>è‹¥æ‚¨å…·å‚™è¼”å°èƒ½åŠ›ï¼Œå»ºè­°è½‰ç‚ºã€Œæ¨è¼”åˆä¸€ã€æ¨¡å¼ã€‚`;
        } else if (mix < 0.5) {
            advice = `ğŸ“‰ <span style="color:#d946ef">å•†å“çµæ§‹æé†’ï¼š</span>çŸ­å¹´æœŸå•†å“ä»£æ•¸çé‡‘åƒ… 2% (æ‰‹å†Š P.9)ã€‚<br><strong>æˆ°ç•¥å»ºè­°ï¼š</strong>æé«˜é•·å¹´æœŸå•†å“ä½”æ¯”ï¼Œä»£æ•¸çé‡‘å°‡å€å¢è‡³ 4%ï¼Œä¸¦äº«æœ‰æ›´é•·ä¹…çš„çºŒæœŸå †ç–Šã€‚`;
        } else if (recruits < 3) {
            advice = `ğŸš€ <span style="color:#10b981">å•Ÿå‹•å»ºè­°ï¼š</span>æ‚¨çš„çµ„ç¹”äººæ•¸è¼ƒå°‘ã€‚æ˜“å®‰ç¶²åˆ¶åº¦å„ªå‹¢åœ¨æ–¼ç´šå·®èˆ‡ä»£æ•¸ã€‚<br><strong>æˆ°ç•¥å»ºè­°ï¼š</strong>ç›®æ¨™ Q3 å¢å“¡è‡³ 5 äººï¼Œå•Ÿå‹•çµ„ç¹”å€å¢æ•ˆæ‡‰ã€‚`;
        } else {
            advice = `ğŸ‘‘ <span style="color:#d946ef">å“è¶Šç‹€æ…‹ï¼š</span>æ‚¨æ­£è™•æ–¼è³‡ç”¢ç´¯ç©çš„é»ƒé‡‘æœŸï¼<br><strong>æˆ°ç•¥å»ºè­°ï¼š</strong>ç¶­æŒé«˜çºŒä¿ç‡ (Kå€¼)ï¼Œåˆ©ç”¨ä»£æ•¸çé‡‘çš„æ·±åº¦å„ªå‹¢ (Gen1 4% + Gen2 1%)ï¼Œæ‰“é€ æ°¸çºŒç¾é‡‘æµã€‚`;
        }
        
        document.getElementById('aiAdvice').innerHTML = advice;
    }

    function updateTableChart(data) {
        let html = '';
        data.forEach(d => {
            html += `<tr>
                <td>Y${d.year}</td>
                <td style="color:var(--color-personal)">$${Math.round(d.self).toLocaleString()}</td>
                <td style="color:var(--color-team)">$${Math.round(d.team).toLocaleString()}</td>
                <td style="color:white; font-weight:bold">$${Math.round(d.total).toLocaleString()}</td>
            </tr>`;
        });
        document.getElementById('tableBody').innerHTML = html;

        const ctx = document.getElementById('mainChart').getContext('2d');
        if(myChart) myChart.destroy();

        let gradientTotal = ctx.createLinearGradient(0, 0, 0, 400);
        gradientTotal.addColorStop(0, 'rgba(255, 255, 255, 0.3)');
        gradientTotal.addColorStop(1, 'rgba(255, 255, 255, 0.0)');

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => 'Y'+d.year),
                datasets: [
                    {
                        label: 'ç¸½è³‡ç”¢ç´¯ç©', data: data.map(d => d.accTotal),
                        borderColor: '#ffffff', backgroundColor: gradientTotal,
                        borderWidth: 3, fill: true, tension: 0.4, pointRadius: 4
                    },
                    {
                        label: 'åœ˜éšŠåˆ©æ½¤ç´¯ç©', data: data.map(d => d.accTeam),
                        borderColor: '#fb923c', borderWidth: 2, borderDash: [5,5],
                        fill: false, tension: 0.4
                    },
                    {
                        label: 'å€‹äººæ”¶å…¥ç´¯ç©', data: data.map(d => d.accSelf),
                        borderColor: '#38bdf8', borderWidth: 2, borderDash: [2,2],
                        fill: false, tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: { 
                    legend: { labels: { color: '#94a3b8' } },
                    tooltip: { 
                        backgroundColor:'rgba(30, 41, 59, 0.9)', 
                        titleColor: '#fff',
                        bodyColor: '#cbd5e1',
                        borderColor: '#475569', borderWidth: 1
                    } 
                },
                scales: {
                    x: { grid:{display:false}, ticks:{color:'#64748b'} },
                    y: { 
                        grid:{color:'#334155', borderDash:[5,5]}, 
                        ticks:{ color:'#64748b', callback: function(value) { return '$' + value.toLocaleString(); } } 
                    }
                }
            }
        });
    }

    window.onload = function() {
        setTimeout(calculate, 100);
    };
</script>

</body>
</html>