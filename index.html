<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®¶æ—å‚³æ‰¿å…¨æ–¹ä½è¦åŠƒç³»çµ± (CFWIP é»ƒå¨é¾)</title>
    <style>
        :root {
            /* æ²‰ç©©å°ˆæ¥­é…è‰² */
            --primary-color: #2C3E50; /* æ·±å²©ç°è— */
            --secondary-color: #C0A062; /* é›…ç·»é‡‘ */
            --bg-color: #F4F6F8;
            --card-bg: #FFFFFF;
            --text-color: #333333;
            --border-color: #DCE0E4;
            --line-color: #666666;

            /* æŒ‰éˆ•é…è‰² */
            --btn-print-bg: #34495E;
            --btn-save-bg: #27AE60;
            --btn-clear-bg: #C0392B;
            --btn-nav-bg: #2980b9; /* å°è¦½æŒ‰éˆ•è— */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 950px; 
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            border-top: 6px solid var(--primary-color);
            display: flex;
            flex-direction: column;
            margin-bottom: 50px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        header h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; line-height: 1.4; }
        header p { margin: 8px 0 0; font-size: 0.9rem; color: var(--secondary-color); opacity: 0.9; }

        /* ä¸»åˆ†é  Tabs */
        .tabs {
            display: flex;
            cursor: pointer;
            border-bottom: 1px solid #e0e0e0;
            background: #fdfdfd;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            color: #7f8c8d;
            transition: 0.3s;
            border-right: 1px solid #eee;
            font-size: 0.95rem;
            white-space: nowrap;
        }
        
        .tab:last-child { border-right: none; }
        .tab.active { background: var(--card-bg); color: var(--primary-color); border-bottom: 4px solid var(--secondary-color); }

        .content { padding: 30px; display: none; flex-grow: 1; }
        .content.active { display: block; }

        /* å•å·å…§éƒ¨å°è¦½åˆ— (Sub-navigation) */
        .q-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .q-step-indicator {
            flex: 1;
            text-align: center;
            font-weight: bold;
            color: #bbb;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .q-step-indicator.active {
            color: var(--primary-color);
            background-color: #f0f4f8;
            border-bottom: 3px solid var(--secondary-color);
        }

        .q-page { display: none; animation: fadeIn 0.4s ease; }
        .q-page.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* å•å·åº•éƒ¨ç¿»é æŒ‰éˆ• */
        .q-footer-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #eee;
        }
        
        .btn-nav {
            padding: 10px 20px;
            background-color: var(--btn-nav-bg);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-nav:disabled { background-color: #ccc; cursor: not-allowed; }
        .btn-nav:hover:not(:disabled) { opacity: 0.9; }

        /* ä¸€èˆ¬æ¨£å¼ */
        .section-title {
            color: var(--primary-color);
            border-left: 4px solid var(--secondary-color);
            padding-left: 15px;
            margin-top: 25px; /* èª¿æ•´é–“è· */
            margin-bottom: 20px;
            font-size: 1.15rem;
            font-weight: 700;
            background-color: #f9f9f9;
            padding-top: 8px;
            padding-bottom: 8px;
        }
        .section-title:first-child { margin-top: 0; }

        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; font-size: 0.95rem; }
        .input-wrapper { position: relative; }
        
        input[type="text"], input[type="number"], textarea {
            width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem; background: #fff; transition: border 0.3s; appearance: none;
        }
        .calc-input, .asset-amount { text-align: right; font-family: Consolas, monospace; }
        input:focus { border-color: var(--secondary-color); outline: none; box-shadow: 0 0 0 2px rgba(192, 160, 98, 0.2); }
        .input-wrapper::after { content: "å…ƒ"; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #999; font-size: 0.9rem; pointer-events: none;}
        input[type="checkbox"], input[type="radio"] { width: 20px; height: 20px; margin-right: 8px; cursor: pointer; accent-color: var(--primary-color); vertical-align: middle; }

        /* ç¶²æ ¼ç³»çµ± */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .q-row { display: flex; gap: 15px; margin-bottom: 10px; }
        .q-col { flex: 1; }

        /* RWD Breakpoints */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .content { padding: 20px 15px; }
            .grid-2 { grid-template-columns: 1fr; gap: 15px; }
            .q-row { flex-direction: column; gap: 15px; }
            .tab { font-size: 0.9rem; padding: 12px 5px; }
            .global-actions { flex-direction: column; padding: 20px; }
            .btn-action { width: 100%; justify-content: center; }
            /* å•å·å°è¦½åœ¨æ‰‹æ©Ÿä¸Šå †ç–Šæˆ–ç°¡åŒ– */
            .q-nav { font-size: 0.8rem; overflow-x: auto; white-space: nowrap; }
        }

        /* æ¨¹ç‹€åœ– (Fixed & Scrollable) */
        .tree-scroll-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; background-color: #fafafa; border: 1px dashed #ccc; border-radius: 8px; padding: 20px 0; position: relative; }
        .mobile-hint { display: none; text-align: center; font-size: 0.8rem; color: #888; margin-bottom: 5px; background: #eee; padding: 4px; border-radius: 4px; }
        @media (max-width: 768px) { .mobile-hint { display: block; } }
        
        .tree-container { display: flex; flex-direction: column; align-items: center; min-width: 800px; padding: 0 20px; }
        .tree-level { display: flex; justify-content: center; position: relative; z-index: 2; flex-wrap: nowrap; }
        .tree-node { background: white; border: 1px solid #ccc; border-top: 4px solid var(--primary-color); padding: 15px; border-radius: 6px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: left; width: 260px; margin: 0 20px; position: relative; }
        .node-title { font-weight: bold; color: var(--primary-color); text-align: center; display: block; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        /* æ¨¹ç‹€åœ–é€£ç·š */
        .connector-bridge-row { display: flex; justify-content: center; height: 30px; width: 100%; }
        .connector-bridge-left, .connector-bridge-right { width: 150px; height: 100%; border-top: 2px solid var(--line-color); }
        .connector-bridge-left { border-right: 2px solid var(--line-color); }
        .connector-stem { width: 2px; height: 30px; background-color: var(--line-color); margin: 0 auto; }
        .branch-bar { height: 20px; border-top: 2px solid var(--line-color); width: 600px; display: flex; justify-content: space-between; margin: 0 auto; position: relative; }
        .branch-drop { width: 2px; height: 20px; background-color: var(--line-color); position: relative; }
        .branch-drop.center { position: absolute; left: 50%; transform: translateX(-50%); top: -30px; height: 50px; background-color: var(--line-color); }

        /* è³‡ç”¢è¡¨æ ¼ */
        .table-scroll-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 20px; border: 1px solid #eee; border-radius: 6px;}
        table.asset-table { width: 100%; min-width: 600px; border-collapse: collapse; }
        table.asset-table th, table.asset-table td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: middle; white-space: nowrap; }
        table.asset-table th { background-color: #eaecee; color: var(--primary-color); font-weight: bold; }
        
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 5px; }
        .checkbox-item { display: flex; align-items: center; cursor: pointer; font-size: 0.95rem; }

        /* æ‰£é™¤é¡ç¾¤çµ„ */
        .deduction-group { border: 1px solid #eee; background: #fafafa; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
        .deduction-title { font-weight: bold; color: var(--secondary-color); margin-bottom: 10px; display: block; font-size: 1rem; }

        /* é¡§å•æ¬„ä½ */
        .advisor-section { background: #fcfcfc; border: 1px solid #e0e0e0; border-left: 5px solid var(--secondary-color); padding: 20px; margin-top: 40px; border-radius: 4px; }
        .advisor-title { font-size: 1.1rem; font-weight: bold; color: var(--primary-color); margin-bottom: 15px; }

        /* æŒ‰éˆ•èˆ‡åŠŸèƒ½å€ */
        .btn-calc { width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 6px; font-size: 1.1rem; cursor: pointer; margin-top: 20px; font-weight: bold; }
        .global-actions { padding: 20px; background-color: #f1f3f5; border-top: 1px solid #e0e0e0; display: flex; gap: 15px; justify-content: flex-end; flex-wrap: wrap; }
        .btn-action { padding: 12px 20px; border: none; border-radius: 4px; font-size: 1rem; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; gap: 8px; justify-content: center; }
        .btn-print { background-color: var(--btn-print-bg); }
        .btn-save { background-color: var(--btn-save-bg); }
        .btn-clear { background-color: var(--btn-clear-bg); }

        /* çµæœé¡¯ç¤º */
        .result-box { background: #fff; border: 1px solid #eee; border-left: 5px solid var(--secondary-color); padding: 20px; border-radius: 4px; margin-top: 30px; display: none; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #e0e0e0; flex-wrap: wrap; }
        .result-value { font-weight: bold; color: var(--primary-color); font-family: Consolas, monospace; }
        .final-tax { font-size: 1.5rem; color: #c0392b; }
        .note { font-size: 0.85rem; color: #777; margin-top: 25px; background: #f1f3f5; padding: 15px; border-radius: 4px; line-height: 1.5; }

        .designer-footer { background-color: var(--primary-color); color: white; text-align: center; padding: 15px; margin-top: auto; font-size: 0.9rem; }
        .designer-name { color: var(--secondary-color); font-weight: bold; margin-left: 5px; }

        /* åˆ—å°æ¨£å¼ - å¼·åˆ¶å±•é–‹æ‰€æœ‰å•å·é  */
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border: none; max-width: 100%; margin: 0; }
            .tabs, .btn-calc, .global-actions, .designer-footer, .note, .mobile-hint, .q-nav, .q-footer-nav { display: none !important; }
            .content { display: none; padding: 0; }
            #questionnaire { display: block !important; }
            
            /* é—œéµï¼šåˆ—å°æ™‚é¡¯ç¤ºæ‰€æœ‰åˆ†é  */
            .q-page { display: block !important; margin-bottom: 30px; border-bottom: 2px dashed #000; padding-bottom: 20px; }
            
            header { background: white; color: black; border-bottom: 2px solid #000; padding: 10px 0; }
            header h1 { color: #000; font-size: 18pt; }
            .section-title { border-left: none; border-bottom: 2px solid #000; padding-left: 0; color: #000; background: none; }
            input, textarea { border: none; border-bottom: 1px solid #ccc; border-radius: 0; padding-left: 0; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .tree-scroll-wrapper, .table-scroll-wrapper { border: none; overflow: visible; }
            .tree-container { min-width: 0; padding: 0; border: none; }
            table.asset-table { min-width: 0; width: 100%; }
            .connector-bridge-left, .connector-bridge-right, .connector-stem, .branch-bar, .branch-drop { background-color: #000 !important; border-color: #000 !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>å®¶æ—å‚³æ‰¿å…¨æ–¹ä½è¦åŠƒç³»çµ±</h1>
        <p>Professional Legacy Planning System (2025)</p>
    </header>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('gift')">è´ˆèˆ‡ç¨…è©¦ç®—</div>
        <div class="tab" onclick="switchTab('estate')">éºç”¢ç¨…è©¦ç®—</div>
        <div class="tab" onclick="switchTab('questionnaire')">å®¶æ—å‚³æ‰¿å•å·</div>
    </div>

    <div id="gift" class="content active">
        <h3 class="section-title">è´ˆèˆ‡è³‡æ–™è¼¸å…¥ (2025åŸºæº–)</h3>
        <div class="form-group">
            <label>æœ¬å¹´åº¦è´ˆèˆ‡ç¸½é¡</label>
            <div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="giftTotal" placeholder="è¼¸å…¥ç¸½é‡‘é¡" onkeyup="formatInput(this)"></div>
        </div>
        <div class="form-group">
            <label>æ¯äººæ¯å¹´å…ç¨…é¡</label>
            <div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="giftExemption" value="2,440,000" onkeyup="formatInput(this)"></div>
        </div>
        <div class="form-group">
            <label>æ‰£é™¤é¡ (åœŸåœ°å¢å€¼ç¨…/å¥‘ç¨…ç­‰)</label>
            <div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="giftDeduction" value="0" onkeyup="formatInput(this)"></div>
        </div>
        <button class="btn-calc" onclick="calculateGiftTax()">è¨ˆç®—è´ˆèˆ‡ç¨…</button>
        <div id="giftResult" class="result-box">
            <div class="result-row"><span class="result-label">è´ˆèˆ‡æ·¨é¡</span><span class="result-value" id="giftNetResult">0 å…ƒ</span></div>
            <div class="result-row"><span class="result-label">é©ç”¨ç¨…ç‡</span><span class="result-value" id="giftRateResult">0%</span></div>
            <div class="result-row"><span class="result-label">ç´¯é€²å·®é¡</span><span class="result-value" id="giftDiffResult">0 å…ƒ</span></div>
            <div class="result-row" style="margin-top:10px;"><span class="result-label" style="font-weight:bold; font-size:1.2rem; align-self:center;">æ‡‰ç´ç¨…é¡</span><span class="result-value final-tax" id="giftTaxResult">0 å…ƒ</span></div>
        </div>
        <div class="note">â€» ä¾æ“š 2025 (æ°‘åœ‹114å¹´) æœ€æ–°ç´šè·è¨ˆç®—ã€‚</div>
    </div>

    <div id="estate" class="content">
        <h3 class="section-title">è³‡ç”¢ç¸½è¦½ (2025åŸºæº–)</h3>
        <div class="form-group">
            <label>éºç”¢ç¸½é¡ (å‹•ç”¢ + ä¸å‹•ç”¢è©•å®šç¾å€¼)</label>
            <div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="estateTotal" placeholder="è¼¸å…¥ç¸½è³‡ç”¢" onkeyup="formatInput(this)"></div>
        </div>
        <div class="form-group">
            <label>å…ç¨…é¡ (ä¸€èˆ¬ 1,333 è¬)</label>
            <div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="estateExemption" value="13,330,000" onkeyup="formatInput(this)"></div>
        </div>

        <h3 class="section-title">æ‰£é™¤é¡ç¸½è¨ˆæ˜ç´°</h3>
        <div class="deduction-group">
            <span class="deduction-title">ğŸ‘¤ è¦ªå±¬/èº«ä»½æ‰£é™¤é¡</span>
            <div class="grid-2">
                <div class="form-group"><label>é…å¶ (553 è¬)</label><div style="padding: 12px; background: white; border: 1px solid #ddd; border-radius: 4px;"><label class="checkbox-item" style="margin:0;"><input type="checkbox" id="deductSpouseCheck" checked> ç¬¦åˆæ‰£é™¤æ¢ä»¶</label></div></div>
                <div class="form-group"><label>ç›´ç³»å‘è¦ªå±¬ (æ¯äºº 56 è¬)</label><div class="input-wrapper"><input type="number" inputmode="numeric" class="calc-input" id="deductChildCount" value="2" placeholder="äººæ•¸" style="text-align:center;"></div></div>
                <div class="form-group"><label>çˆ¶æ¯ (æ¯äºº 138 è¬)</label><div class="input-wrapper"><input type="number" inputmode="numeric" class="calc-input" id="deductParentCount" value="0" placeholder="äººæ•¸" style="text-align:center;"></div></div>
                <div class="form-group"><label>é‡åº¦èº«å¿ƒéšœç¤™ (æ¯äºº 693 è¬)</label><div class="input-wrapper"><input type="number" inputmode="numeric" class="calc-input" id="deductDisabledCount" value="0" placeholder="äººæ•¸" style="text-align:center;"></div></div>
            </div>
        </div>
        <div class="deduction-group">
            <span class="deduction-title">ğŸ’° è²¡ç”¢/å‚µå‹™/è²»ç”¨æ‰£é™¤é¡</span>
            <div class="grid-2">
                 <div class="form-group"><label>å–ªè‘¬è²» (é è¨­ 138 è¬)</label><div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="deductFuneral" value="1,380,000" onkeyup="formatInput(this)"></div></div>
                <div class="form-group"><label>è¾²åœ°åŠå…¶ä»–åœ°ä¸Šä½œç‰©</label><div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="deductAgri" value="0" onkeyup="formatInput(this)"></div></div>
                <div class="form-group"><label>æ‡‰ç´æœªç´ç¨…æ</label><div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="deductUnpaidTax" value="0" onkeyup="formatInput(this)"></div></div>
                <div class="form-group"><label>æœªå„Ÿå‚µå‹™</label><div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="deductDebt" value="0" onkeyup="formatInput(this)"></div></div>
                <div class="form-group"><label>å…¬å…±è¨­æ–½ä¿ç•™åœ°</label><div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="deductPublicLand" value="0" onkeyup="formatInput(this)"></div></div>
                <div class="form-group"><label>æ°‘æ³•ç¬¬1030-1æ¢</label><div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="deduct1030" value="0" onkeyup="formatInput(this)"></div></div>
                <div class="form-group"><label>æ­»äº¡å‰6-9å¹´å·²ç´éºç”¢ç¨…</label><div class="input-wrapper"><input type="text" inputmode="numeric" class="calc-input" id="deductPriorTax" value="0" onkeyup="formatInput(this)"></div></div>
            </div>
        </div>
        <button class="btn-calc" onclick="calculateEstateTax()">è¨ˆç®—éºç”¢ç¨…</button>
        <div id="estateResult" class="result-box">
             <div class="result-row"><span class="result-label">éºç”¢æ·¨é¡</span><span class="result-value" id="estateNetResult">0 å…ƒ</span></div>
            <div class="result-row"><span class="result-label">é©ç”¨ç¨…ç‡</span><span class="result-value" id="estateRateResult">0%</span></div>
            <div class="result-row"><span class="result-label">ç´¯é€²å·®é¡</span><span class="result-value" id="estateDiffResult">0 å…ƒ</span></div>
            <div class="result-row" style="margin-top:10px;"><span class="result-label" style="font-weight:bold; font-size:1.2rem; align-self:center;">æ‡‰ç´ç¨…é¡</span><span class="result-value final-tax" id="estateTaxResult">0 å…ƒ</span></div>
             <div class="result-row" style="border-top:1px solid #eee; padding-top:10px; margin-top:10px;"><span class="result-label">æ‰£é™¤é¡ç¸½è¨ˆ</span><span class="result-value" id="totalDeductionDisplay" style="color:#666;">0 å…ƒ</span></div>
        </div>
        <div class="note">â€» ä¾æ“š 2025 (æ°‘åœ‹114å¹´) æœ€æ–°ç´šè·èˆ‡æ‰£é™¤é¡è¨ˆç®—ã€‚</div>
    </div>

    <div id="questionnaire" class="content">
        
        <div class="q-nav">
            <div class="q-step-indicator active" onclick="goToPage(1)" id="step-ind-1">1. åŸºæœ¬èˆ‡å®¶æ—</div>
            <div class="q-step-indicator" onclick="goToPage(2)" id="step-ind-2">2. è³‡ç”¢èˆ‡æ„å‘</div>
            <div class="q-step-indicator" onclick="goToPage(3)" id="step-ind-3">3. è£œå……èˆ‡é¡§å•</div>
        </div>

        <div id="q-page-1" class="q-page active">
            <h3 class="section-title">ä¸€ã€åŸºæœ¬è³‡æ–™</h3>
            <div class="q-row">
                <div class="q-col"><label>1. å§“å</label><input type="text" class="q-input"></div>
                <div class="q-col"><label>2. è·æ¥­/è·ç¨±</label><input type="text" class="q-input"></div>
                <div class="q-col"><label>3. å‡ºç”Ÿå¹´æ¬¡</label><input type="text" class="q-input"></div>
            </div>

            <h3 class="section-title">äºŒã€å®¶æ—äººç‰©é—œä¿‚åœ– (Tree Diagram)</h3>
            <div class="mobile-hint">â† å·¦å³æ»‘å‹•æŸ¥çœ‹å®Œæ•´åœ–è¡¨ â†’</div>
            <div class="tree-scroll-wrapper">
                <div class="tree-container">
                    <div class="tree-level">
                        <div class="tree-node"><span class="node-title">çˆ¶è¦ª (ç¬¬ä¸€ä»£)</span><div style="display:flex; gap:10px; margin-bottom:10px;"><input type="text" placeholder="å¹´é½¡" style="width:100%;"></div><div class="checkbox-group"><label class="checkbox-item"><input type="radio" name="f_status"> å­˜</label><label class="checkbox-item"><input type="radio" name="f_status"> æ­¿</label><label class="checkbox-item"><input type="checkbox"> é›¢/å†</label></div></div>
                        <div class="tree-node"><span class="node-title">æ¯è¦ª (ç¬¬ä¸€ä»£)</span><div style="display:flex; gap:10px; margin-bottom:10px;"><input type="text" placeholder="å¹´é½¡" style="width:100%;"></div><div class="checkbox-group"><label class="checkbox-item"><input type="radio" name="m_status"> å­˜</label><label class="checkbox-item"><input type="radio" name="m_status"> æ­¿</label><label class="checkbox-item"><input type="checkbox"> é›¢/å†</label></div></div>
                    </div>
                    <div class="connector-bridge-row"><div class="connector-bridge-left"></div><div class="connector-bridge-right"></div></div>
                    <div class="tree-level" style="margin-top: 0;">
                        <div class="tree-node" style="width: 320px; border-top-color: var(--secondary-color);"><span class="node-title" style="color:var(--secondary-color);">æœ¬äººèˆ‡é…å¶ (ç¬¬äºŒä»£)</span>
                            <div class="q-row">
                                <div style="flex:1;"><label style="font-size:0.9rem;">æœ¬äºº</label><div class="checkbox-group" style="margin-bottom:5px;"><label><input type="radio" name="sg">ç”·</label><label><input type="radio" name="sg">å¥³</label></div><input type="text" placeholder="å¹´é½¡" style="margin-bottom:5px;"></div>
                                <div style="flex:1; border-left:1px solid #eee; padding-left:10px;"><label style="font-size:0.9rem;">é…å¶</label><div class="checkbox-group" style="margin-bottom:5px;"><label><input type="radio" name="sp">æœ‰</label><label><input type="radio" name="sp">ç„¡</label></div><input type="text" placeholder="å¹´é½¡" style="margin-bottom:5px;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="connector-stem"></div>
                    <div class="branch-bar"><div class="branch-drop"></div><div class="branch-drop center"></div><div class="branch-drop"></div></div>
                    <div class="tree-level">
                        <div class="tree-node" style="width: 200px;"><span class="node-title">å­å¥³ 1 (ç¬¬ä¸‰ä»£)</span><div style="margin-bottom:5px;"><input type="radio" name="c1g">ç”· <input type="radio" name="c1g">å¥³</div><input type="text" placeholder="å¹´é½¡" style="margin-bottom:5px;"><label class="checkbox-item"><input type="checkbox"> æœ‰é…å¶</label><input type="text" placeholder="å­«å­å¥³æ•¸"></div>
                        <div class="tree-node" style="width: 200px;"><span class="node-title">å­å¥³ 2 (ç¬¬ä¸‰ä»£)</span><div style="margin-bottom:5px;"><input type="radio" name="c2g">ç”· <input type="radio" name="c2g">å¥³</div><input type="text" placeholder="å¹´é½¡" style="margin-bottom:5px;"><label class="checkbox-item"><input type="checkbox"> æœ‰é…å¶</label><input type="text" placeholder="å­«å­å¥³æ•¸"></div>
                        <div class="tree-node" style="width: 200px;"><span class="node-title">å­å¥³ 3 (ç¬¬ä¸‰ä»£)</span><div style="margin-bottom:5px;"><input type="radio" name="c3g">ç”· <input type="radio" name="c3g">å¥³</div><input type="text" placeholder="å¹´é½¡" style="margin-bottom:5px;"><label class="checkbox-item"><input type="checkbox"> æœ‰é…å¶</label><input type="text" placeholder="å­«å­å¥³æ•¸"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="q-page-2" class="q-page">
            <h3 class="section-title">ä¸‰ã€è³‡ç”¢çµæ§‹ç›¤é» (ä¼°å€¼)</h3>
            <div class="mobile-hint">â† å·¦å³æ»‘å‹•å¡«å¯«è¡¨æ ¼ â†’</div>
            <div class="table-scroll-wrapper">
                <table class="asset-table">
                    <thead><tr><th>è³‡ç”¢é¡åˆ¥</th><th style="width:10%;">æ“æœ‰</th><th>å¤§è‡´é‡‘é¡</th><th>å‚™è¨» (æŒæœ‰æ–¹å¼/ç™»è¨˜äºº)</th></tr></thead>
                    <tbody>
                        <tr><td>è‡ªç”¨ä½å®…</td><td><input type="checkbox"></td><td><input type="text" class="q-input asset-amount" inputmode="numeric" onkeyup="formatInput(this)"></td><td><input type="text" class="q-input"></td></tr>
                        <tr><td>æŠ•è³‡å‹ä¸å‹•ç”¢</td><td><input type="checkbox"></td><td><input type="text" class="q-input asset-amount" inputmode="numeric" onkeyup="formatInput(this)"></td><td><input type="text" class="q-input"></td></tr>
                        <tr><td>å…¬å¸è‚¡æ¬Š/äº‹æ¥­æŒä»½</td><td><input type="checkbox"></td><td><input type="text" class="q-input asset-amount" inputmode="numeric" onkeyup="formatInput(this)"></td><td><input type="text" class="q-input" placeholder="å…¬å¸åç¨±"></td></tr>
                        <tr><td>é‡‘èè³‡ç”¢(ç¾é‡‘/è‚¡ç¥¨)</td><td><input type="checkbox"></td><td><input type="text" class="q-input asset-amount" inputmode="numeric" onkeyup="formatInput(this)"></td><td><input type="text" class="q-input"></td></tr>
                        <tr><td>ä¿éšªè³‡ç”¢(å£½éšª/å¹´é‡‘)</td><td><input type="checkbox"></td><td><input type="text" class="q-input asset-amount" inputmode="numeric" onkeyup="formatInput(this)"></td><td><input type="text" class="q-input" placeholder="å—ç›Šäºº?"></td></tr>
                        <tr><td>æµ·å¤–è³‡ç”¢</td><td><input type="checkbox"></td><td><input type="text" class="q-input asset-amount" inputmode="numeric" onkeyup="formatInput(this)"></td><td><input type="text" class="q-input" placeholder="åœ‹åˆ¥/ç¨…å‹™èº«åˆ†"></td></tr>
                        <tr><td>æ”¶è—å“(è—è¡“/ç å¯¶)</td><td><input type="checkbox"></td><td><input type="text" class="q-input asset-amount" inputmode="numeric" onkeyup="formatInput(this)"></td><td><input type="text" class="q-input"></td></tr>
                    </tbody>
                </table>
            </div>

            <h3 class="section-title">å››ã€å‚³æ‰¿æ„å‘èˆ‡é¢¨éšª</h3>
            <div class="form-group"><label>1. æ‚¨ç›®å‰æ˜¯å¦æœ‰è¦åŠƒå‚³æ‰¿çš„æƒ³æ³•ï¼Ÿ</label><div class="checkbox-group"><label class="checkbox-item"><input type="radio" name="plan_status"> å·²è¦åŠƒéƒ¨åˆ†</label><label class="checkbox-item"><input type="radio" name="plan_status"> æ­£åœ¨è€ƒæ…®ä¸­</label><label class="checkbox-item"><input type="radio" name="plan_status"> å°šæœªé–‹å§‹</label></div></div>
            <div class="form-group"><label>2. æ‚¨é—œå¿ƒçš„å‚³æ‰¿ç›®æ¨™ç‚ºï¼Ÿ(å¯è¤‡é¸)</label><div class="checkbox-group"><label class="checkbox-item"><input type="checkbox"> è²¡ç”¢åˆ†é…å…¬å¹³æ€§</label><label class="checkbox-item"><input type="checkbox"> å®¶æ—ä¼æ¥­æ°¸çºŒç¶“ç‡Ÿ</label><label class="checkbox-item"><input type="checkbox"> å­å¥³æ•™è‚²/ç…§è­·ä¿éšœ</label><label class="checkbox-item"><input type="checkbox"> å‚³æ‰¿å®¶æ—ç²¾ç¥åƒ¹å€¼è§€</label><label class="checkbox-item"><input type="checkbox"> æ¸›å°‘éºç”¢ç¨…æˆ–ç¯€ç¨…å•é¡Œ</label><label class="checkbox-item"><input type="checkbox"> ä¸çŸ¥é“å¾å“ªè£¡é–‹å§‹</label></div></div>
            <div class="form-group"><label>3. é¢¨éšªèˆ‡æ“”æ†‚ (è«‹é¸å‰ä¸‰é …)</label><div class="checkbox-group"><label class="checkbox-item"><input type="checkbox"> å®¶ç”¢åˆ†é…ä¸å…¬å¹³å¼•ç™¼ç³¾ç´›</label><label class="checkbox-item"><input type="checkbox"> å­å¥³èƒ½åŠ›ä¸è¶³ã€ç„¡æ³•æ¥ç­</label><label class="checkbox-item"><input type="checkbox"> å­å¥³å©šå§»å°è‡´è³‡ç”¢å¤–æµ</label><label class="checkbox-item"><input type="checkbox"> äºŒä»£ä¹‹é–“ä¸åˆ</label><label class="checkbox-item"><input type="checkbox"> ç¨…å‹™æˆæœ¬éé«˜</label><label class="checkbox-item"><input type="checkbox"> é…å¶æˆ–é•·è¼©æœªç´å…¥å®‰æ’</label></div></div>
        </div>

        <div id="q-page-3" class="q-page">
            <h3 class="section-title">äº”ã€è£œå……èªªæ˜äº‹é …</h3>
            <textarea placeholder="è«‹å¡«å¯«å…¶ä»–è£œå……äº‹é …..."></textarea>
            
            <div class="advisor-section">
                <div class="advisor-title">ğŸ“ é¡§å•è³‡æ–™ (Consultant Profile)</div>
                <div class="grid-2">
                    <div><label>ä¸»è¦é¡§å• (Primary Advisor)</label><input type="text" placeholder="å§“å" style="margin-bottom:10px;"><input type="text" placeholder="è¯çµ¡é›»è©± / ID"></div>
                    <div><label>å”åŒé¡§å• (Co-Advisor)</label><input type="text" placeholder="å§“å" style="margin-bottom:10px;"><input type="text" placeholder="åˆ†å·¥é …ç›® / å‚™è¨»"></div>
                </div>
            </div>
        </div>

        <div class="q-footer-nav">
            <button class="btn-nav" id="btn-prev" onclick="changePage(-1)" disabled>â† ä¸Šä¸€é </button>
            <button class="btn-nav" id="btn-next" onclick="changePage(1)">ä¸‹ä¸€é  â†’</button>
        </div>
    </div>

    <div class="global-actions">
        <button class="btn-action btn-print" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°å•å·</button>
        <button class="btn-action btn-save" onclick="saveAsHTML()">ğŸ’¾ å¦å­˜æª”æ¡ˆ</button>
        <button class="btn-action btn-clear" onclick="clearAllData()">ğŸ—‘ï¸ åˆªé™¤ä¸Šè¿°è³‡æ–™</button>
    </div>

    <div class="designer-footer">è¨­è¨ˆè€…ï¼šCFWIP åœ‹éš›å®¶æ—å‚³æ‰¿è¦åŠƒå¸« <span class="designer-name">é»ƒå¨é¾</span></div>
</div>

<script>
    function formatInput(input) {
        let val = input.value.replace(/[^0-9]/g, '');
        if (val === "") { input.value = ""; return; }
        input.value = parseInt(val).toLocaleString('en-US');
    }

    function getRawValue(id) {
        let el = document.getElementById(id);
        if(!el) return 0;
        let val = el.value.replace(/,/g, '');
        return parseFloat(val) || 0;
    }

    function formatMoney(amount) {
        return amount.toLocaleString('zh-TW') + " å…ƒ";
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        const tabs = document.querySelectorAll('.tab');
        if(tabName === 'gift') tabs[0].classList.add('active');
        else if(tabName === 'estate') tabs[1].classList.add('active');
        else tabs[2].classList.add('active');
    }

    /* å•å·åˆ†é é‚è¼¯ */
    let currentQPage = 1;
    const totalQPages = 3;

    function showQPage(page) {
        // éš±è—æ‰€æœ‰é é¢
        for(let i=1; i<=totalQPages; i++) {
            document.getElementById('q-page-'+i).classList.remove('active');
            document.getElementById('step-ind-'+i).classList.remove('active');
        }
        // é¡¯ç¤ºç›®æ¨™é é¢
        document.getElementById('q-page-'+page).classList.add('active');
        document.getElementById('step-ind-'+page).classList.add('active');
        
        currentQPage = page;
        updateNavButtons();
    }

    function changePage(direction) {
        let newPage = currentQPage + direction;
        if(newPage >= 1 && newPage <= totalQPages) {
            showQPage(newPage);
            // æ²å‹•åˆ°å•å·é ‚éƒ¨
            document.getElementById('questionnaire').scrollIntoView({behavior: 'smooth'});
        }
    }

    function goToPage(page) {
        showQPage(page);
    }

    function updateNavButtons() {
        document.getElementById('btn-prev').disabled = (currentQPage === 1);
        document.getElementById('btn-next').disabled = (currentQPage === totalQPages);
        if(currentQPage === totalQPages) {
            document.getElementById('btn-next').style.opacity = "0.5";
            document.getElementById('btn-next').innerText = "å¡«å¯«å®Œæˆ";
        } else {
            document.getElementById('btn-next').style.opacity = "1";
            document.getElementById('btn-next').innerText = "ä¸‹ä¸€é  â†’";
        }
    }

    // 2025 è´ˆèˆ‡ç¨…è¨ˆç®—
    function calculateGiftTax() {
        const total = getRawValue('giftTotal');
        const exemption = getRawValue('giftExemption');
        const deduction = getRawValue('giftDeduction');
        let net = total - exemption - deduction;
        if (net < 0) net = 0;
        let tax = 0, rate = 0, diff = 0;
        if (net <= 28110000) { rate = 10; diff = 0; tax = net * 0.1; } 
        else if (net <= 56210000) { rate = 15; diff = 1405500; tax = net * 0.15 - diff; } 
        else { rate = 20; diff = 4216000; tax = net * 0.2 - diff; }
        document.getElementById('giftNetResult').innerText = formatMoney(net);
        document.getElementById('giftRateResult').innerText = rate + "%";
        document.getElementById('giftDiffResult').innerText = formatMoney(diff);
        document.getElementById('giftTaxResult').innerText = formatMoney(Math.round(tax));
        document.getElementById('giftResult').style.display = 'block';
    }

    // 2025 éºç”¢ç¨…è¨ˆç®— (è©³ç´°æ‰£é™¤é¡)
    function calculateEstateTax() {
        const total = getRawValue('estateTotal');
        const exemption = getRawValue('estateExemption');
        let valSpouse = document.getElementById('deductSpouseCheck').checked ? 5530000 : 0;
        const valChild = getRawValue('deductChildCount') * 560000;
        const valParent = getRawValue('deductParentCount') * 1380000;
        const valDisabled = getRawValue('deductDisabledCount') * 6930000;
        const valFuneral = getRawValue('deductFuneral');
        const valAgri = getRawValue('deductAgri');
        const valUnpaidTax = getRawValue('deductUnpaidTax');
        const valDebt = getRawValue('deductDebt');
        const valPublicLand = getRawValue('deductPublicLand');
        const val1030 = getRawValue('deduct1030');
        const valPriorTax = getRawValue('deductPriorTax');

        const totalDeduction = valSpouse + valChild + valParent + valDisabled + 
                               valFuneral + valAgri + valUnpaidTax + valDebt + 
                               valPublicLand + val1030 + valPriorTax;

        let net = total - exemption - totalDeduction;
        if (net < 0) net = 0;

        let tax = 0, rate = 0, diff = 0;
        if (net <= 56210000) { rate = 10; diff = 0; tax = net * 0.1; } 
        else if (net <= 112420000) { rate = 15; diff = 2810500; tax = net * 0.15 - diff; } 
        else { rate = 20; diff = 8431500; tax = net * 0.2 - diff; }

        document.getElementById('estateNetResult').innerText = formatMoney(net);
        document.getElementById('estateRateResult').innerText = rate + "%";
        document.getElementById('estateDiffResult').innerText = formatMoney(diff);
        document.getElementById('estateTaxResult').innerText = formatMoney(Math.round(tax));
        document.getElementById('totalDeductionDisplay').innerText = formatMoney(totalDeduction);
        document.getElementById('estateResult').style.display = 'block';
    }

    // æ¸…é™¤è³‡æ–™
    function clearAllData() {
        if(!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è¼¸å…¥çš„è³‡æ–™å—ï¼Ÿ(ç¨…åˆ¶é è¨­å€¼å°‡ä¿ç•™)')) return;
        document.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => {
            if(input.id === 'giftExemption') input.value = "2,440,000";
            else if(input.id === 'estateExemption') input.value = "13,330,000";
            else if(input.id === 'deductFuneral') input.value = "1,380,000";
            else if(input.id === 'deductChildCount') input.value = "2";
            else if(['deductParentCount', 'deductDisabledCount'].includes(input.id)) input.value = "0";
            else if(['deductAgri', 'deductUnpaidTax', 'deductDebt', 'deductPublicLand', 'deduct1030', 'deductPriorTax', 'giftDeduction'].includes(input.id)) input.value = "0";
            else input.value = "";
        });
        document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(box => {
            if(box.id === 'deductSpouseCheck') box.checked = true;
            else box.checked = false;
        });
        document.querySelectorAll('#giftResult, #estateResult').forEach(div => div.style.display = 'none');
        // é‡ç½®å•å·é ç¢¼
        showQPage(1);
    }

    // å¦å­˜å­˜æª”
    function saveAsHTML() {
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            if (input.type === 'checkbox' || input.type === 'radio') {
                if (input.checked) input.setAttribute('checked', 'checked');
                else input.removeAttribute('checked');
            } else {
                input.setAttribute('value', input.value);
                if (input.tagName === 'TEXTAREA') input.innerHTML = input.value;
            }
        });
        const htmlContent = "<!DOCTYPE html>" + document.documentElement.outerHTML;
        const blob = new Blob([htmlContent], {type: 'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'å®¶æ—å‚³æ‰¿è¦åŠƒ_' + new Date().toISOString().slice(0,10) + '.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>