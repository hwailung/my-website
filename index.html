<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜“å®‰ç¶² - æ¥­å‹™åˆ¶åº¦æˆ°ç•¥æ¨¡æ“¬ç³»çµ± V27</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f172a;       
            --bg-panel: #1e293b;      
            --border-color: #334155;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            
            --color-personal: #38bdf8; 
            --color-team: #fb923c;     
            --color-total: #ffffff;    
            --color-accent: #6366f1;   
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-ai: #d946ef; /* AI å°ˆå±¬ç´«ç²‰è‰² */
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 360px;
            background-color: #020617;
            border-right: 1px solid var(--border-color);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        /* --- Main --- */
        .main-content {
            margin-left: 360px;
            flex-grow: 1;
            padding: 40px;
            background-image: radial-gradient(circle at top right, #1e293b 0%, transparent 40%);
        }

        /* --- UI Components --- */
        .section-header {
            font-size: 0.85rem; font-weight: 700; color: var(--color-accent);
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px;
        }

        .custom-select {
            background-color: #1e293b; border: 1px solid #475569; color: white;
            border-radius: 8px; padding: 10px; width: 100%; font-size: 0.9rem;
            cursor: pointer; margin-bottom: 10px;
        }
        
        .range-block { margin-bottom: 20px; }
        .range-label { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-sub); margin-bottom: 5px; }
        .range-val { font-family: 'JetBrains Mono', monospace; font-weight: bold; color: var(--color-personal); font-size: 1rem; }
        input[type=range] { width: 100%; accent-color: var(--color-personal); cursor: pointer; }

        .def-box {
            background: rgba(99, 102, 241, 0.1);
            border-left: 3px solid var(--color-accent);
            padding: 12px; margin-bottom: 15px;
            font-size: 0.8rem; color: #cbd5e1; line-height: 1.5;
        }
        .def-tag { background: var(--color-accent); color: white; padding: 1px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-right: 5px; }

        /* è­¦ç¤ºæ¡† */
        .alert-box {
            background: rgba(245, 158, 11, 0.15); border: 1px solid var(--color-warning);
            border-radius: 12px; padding: 15px; margin-bottom: 25px; display: none;
            animation: fadeIn 0.5s;
        }
        .alert-title { color: var(--color-warning); font-weight: 800; font-size: 1rem; margin-bottom: 5px; }
        .alert-desc { color: #e2e8f0; font-size: 0.9rem; line-height: 1.5; }

        /* AI é¡§å•å¡ç‰‡ */
        .ai-card {
            background: linear-gradient(135deg, rgba(217, 70, 239, 0.1), rgba(124, 58, 237, 0.1));
            border: 1px solid rgba(217, 70, 239, 0.4);
            border-radius: 16px; padding: 20px; margin-bottom: 30px;
            display: flex; gap: 20px; align-items: start;
            box-shadow: 0 0 20px rgba(217, 70, 239, 0.1);
            transition: all 0.3s;
        }
        .ai-icon {
            width: 50px; height: 50px; background: var(--color-ai); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: white; flex-shrink: 0;
            box-shadow: 0 0 15px var(--color-ai);
        }
        .ai-content h5 { color: var(--color-ai); font-weight: 800; margin-bottom: 8px; font-size: 1rem; text-transform: uppercase; }
        .ai-text { color: #f1f5f9; font-size: 0.95rem; line-height: 1.6; font-weight: 500; }

        /* KPI & Charts */
        .kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        .kpi-title { font-size: 0.9rem; font-weight: 700; color: white; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; display: flex; justify-content: space-between; }
        .kpi-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; color: var(--text-sub); }
        .kpi-row.highlight { margin-top: 12px; padding-top: 10px; border-top: 1px dashed #475569; font-weight: 800; font-size: 1.1rem; color: white; }
        
        .val-p { color: var(--color-personal); font-family: 'JetBrains Mono'; }
        .val-t { color: var(--color-team); font-family: 'JetBrains Mono'; }
        .val-tot { color: white; font-family: 'JetBrains Mono'; }

        .leverage-box { background: linear-gradient(145deg, #1e293b, #0f172a); border: 1px solid #475569; border-radius: 16px; padding: 30px; margin-bottom: 30px; }
        .lev-grid { display: grid; grid-template-columns: 1fr 180px 1fr; gap: 20px; align-items: center; }
        .lev-col { text-align: center; background: rgba(255,255,255,0.03); border-radius: 10px; padding: 20px; height: 100%; display: flex; flex-direction: column; justify-content: center; }
        .lev-value { font-size: 1.6rem; font-weight: 800; color: white; font-family: 'JetBrains Mono'; margin-bottom: 5px; }
        .lev-circle { width: 130px; height: 130px; border-radius: 50%; background: #020617; border: 4px solid var(--color-success); margin: 0 auto; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(16, 185, 129, 0.2); }
        .lev-x { font-size: 2.2rem; font-weight: 900; color: var(--color-success); font-family: 'JetBrains Mono'; line-height: 1; }

        .bottom-section { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; }
        .panel { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        .table-custom { width: 100%; font-size: 0.9rem; color: var(--text-sub); text-align: right; }
        .table-custom th { padding: 10px; color: white; border-bottom: 1px solid var(--border-color); text-align: right; }
        .table-custom th:first-child { text-align: center; }
        .table-custom td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: 'JetBrains Mono'; }
        .table-custom td:first-child { text-align: center; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="mb-3">
        <h4 class="fw-bold m-0 text-white"><i class="fas fa-shield-alt me-2 text-primary"></i>æ˜“å®‰ç¶² e-Insure</h4>
        <small class="text-white opacity-50">åˆ¶åº¦æ¨¡æ“¬ç³»çµ± V27</small>
    </div>

    <div class="def-box">
        <div><span class="def-tag">TFYB</span> <strong>ç™¼æ”¾æ¥­ç¸¾å®šç¾©ï¼š</strong></div>
        æœ¬ç³»çµ±æ•¸å€¼ç‚º <strong>TFYB (FYB x 90%)</strong>ã€‚<br>
        è¼¸å…¥èˆ‡é¡¯ç¤ºçš†ç‚ºæ–°å°å¹£(NTD)ã€‚
    </div>

    <div>
        <div class="section-header"><i class="fas fa-chess"></i> æ¨è¼”æˆ°ç•¥</div>
        <select class="custom-select" id="strategySelect" onchange="calculate()">
            <option value="A">ğŸ›¡ï¸ æ¨è¼”åˆä¸€ (100% åˆ©å·®)</option>
            <option value="B">ğŸ¤ æ¨è¼”åˆ†é–‹ (30% åˆ©å·®)</option>
        </select>
        <div class="mt-2 small text-sub" style="font-size: 0.75rem;">
            * æ¨è–¦äººé ˜å–é¦–å¹´åº¦çµ„ç¹”çé‡‘ä¹‹ 30%
        </div>
    </div>

    <hr class="border-secondary opacity-25">

    <div>
        <div class="section-header"><i class="fas fa-user-tag"></i> è·ç´šè¨­å®š</div>
        
        <div class="row g-2">
            <div class="col-6">
                <label class="small text-sub mb-1">æ‚¨çš„è·ç´š</label>
                <select id="myRank" class="custom-select" onchange="calculate()">
                    <option value="0.92">VP (92%)</option>
                    <option value="0.90">AVP (90%)</option>
                    <option value="0.83" selected>SBD (83%)</option>
                    <option value="0.75">UM (75%)</option>
                    <option value="0.70">BAS (70%)</option>
                    <option value="0.60">AG (60%)</option>
                </select>
            </div>
            <div class="col-6">
                <label class="small text-sub mb-1">åœ˜éšŠè·ç´š</label>
                <select id="subRank" class="custom-select" onchange="calculate()">
                    <option value="0.92">VP (92%)</option>
                    <option value="0.90">AVP (90%)</option>
                    <option value="0.83">SBD (83%)</option>
                    <option value="0.75">UM (75%)</option>
                    <option value="0.70">BAS (70%)</option>
                    <option value="0.60" selected>AG (60%)</option>
                </select>
            </div>
        </div>
    </div>

    <hr class="border-secondary opacity-25">

    <div>
        <div class="section-header"><i class="fas fa-chart-pie"></i> å•†å“é…ç½®</div>
        <label class="small text-sub mb-1">é•·å¹´æœŸ vs çŸ­å¹´æœŸ/æŠ•è³‡å‹</label>
        <select class="custom-select" id="productMix" onchange="calculate()">
            <option value="1.0">100% é•·å¹´æœŸ</option>
            <option value="0.8">80% é•·å¹´æœŸ + 20% çŸ­å¤©æœŸ</option>
            <option value="0.5">50% é•·å¹´æœŸ + 50% çŸ­å¤©æœŸ</option>
            <option value="0.2">20% é•·å¹´æœŸ + 80% çŸ­å¤©æœŸ</option>
            <option value="0.0">100% çŸ­å¤©æœŸ (ç„¡çºŒæœŸ)</option>
        </select>
        <div class="small text-sub" style="font-size: 0.75rem;">
            * ä¾æ¯”ä¾‹åŠ æ¬Šè¨ˆç®—ä»£æ•¸çé‡‘èˆ‡çºŒæœŸåˆ©ç›Š
        </div>
    </div>

    <hr class="border-secondary opacity-25">

    <div>
        <div class="section-header"><i class="fas fa-sliders-h"></i> æ¥­ç¸¾åƒæ•¸ (TFYB)</div>
        
        <div class="range-block">
            <div class="range-label"><span>å€‹äºº TFYB</span><span class="range-val" id="valSales">$100,000</span></div>
            <input type="range" id="sliderSales" min="1" max="500" value="10" step="1" oninput="calculate()">
        </div>

        <div class="range-block">
            <div class="range-label"><span>åœ˜éšŠå¹³å‡ TFYB</span><span class="range-val" id="valTeamSales">$100,000</span></div>
            <input type="range" id="sliderTeamSales" min="1" max="500" value="10" step="1" oninput="calculate()">
        </div>

        <div class="range-block">
            <div class="range-label"><span>åœ˜éšŠäººæ•¸</span><span class="range-val" id="valRecruits">3 äºº</span></div>
            <input type="range" id="sliderRecruits" min="0" max="100" value="3" oninput="calculate()">
        </div>

        <div class="range-block">
            <div class="range-label"><span>çºŒä¿ç‡</span><span class="range-val" id="valRetention">90%</span></div>
            <input type="range" id="sliderRetention" min="50" max="100" value="90" oninput="calculate()">
        </div>
    </div>

    <div class="mt-auto pt-3 border-top border-secondary border-opacity-25 small text-sub" style="font-size:0.7rem;">
        è¨­è¨ˆè€…ï¼šWilson Huang<br>
        è³‡æ–™ä¾†æºï¼šæ˜“å®‰ç¶²åˆ¶åº¦æ‰‹å†Š 1140226ç‰ˆ
    </div>
</div>

<div class="main-content">

    <div id="splitAlert" class="alert-box">
        <div class="alert-title">
            <i class="fas fa-exclamation-triangle"></i> åˆ¶åº¦æé†’ï¼šå•Ÿå‹•ã€Œæ¨è¼”åˆ†é–‹ã€è¨ˆç®—
        </div>
        <div class="alert-desc">
            åµæ¸¬åˆ° <strong>å¹³éšå¢å“¡</strong> æˆ– <strong>ä½éšå¢é«˜éš</strong> ç‹€æ³ã€‚<br>
            æ‚¨çš„æ¥­ç¸¾çé‡‘å°‡æ¡ã€Œæ¨è–¦äººã€èº«åˆ†è¨ˆç®—ï¼š<br>
            <span style="color:white; font-weight:bold;">åƒ…é ˜å–é¦–å¹´åº¦çµ„ç¹”åˆ©æ½¤ä¹‹ 30%ï¼ŒçºŒæœŸåˆ©ç›Šå°‡æ­¸å±¬è¼”å°äººã€‚</span>
        </div>
    </div>

    <div class="ai-card">
        <div class="ai-icon"><i class="fas fa-robot"></i></div>
        <div class="ai-content">
            <h5>HEBORN AI æˆ°ç•¥é¡§å•</h5>
            <div class="ai-text" id="aiAdvice">
                æ­£åœ¨åˆ†ææ‚¨çš„çµ„ç¹”æ•¸æ“š...
            </div>
        </div>
    </div>

    <div class="mb-4">
        <h4 class="fw-bold text-white m-0">æ”¶ç›Šé æ¸¬çŸ©é™£ (REVENUE MATRIX)</h4>
        <span class="text-sub small">å«é¦–å¹´åº¦ä½£é‡‘ã€çµ„ç¹”åˆ©å·®ã€ä»£æ•¸çé‡‘åŠåŠ æ¬ŠçºŒæœŸåˆ©ç›Š (å–®ä½: æ–°å°å¹£/å…ƒ)</span>
    </div>

    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-title"><span>ç¬¬ 1 å¹´ (Start)</span><i class="fas fa-flag text-white opacity-25"></i></div>
            <div class="kpi-row"><span>å€‹äººæ”¶å…¥</span><span class="val-p" id="y1_self">$0</span></div>
            <div class="kpi-row"><span>çµ„ç¹”åˆ©æ½¤</span><span class="val-t" id="y1_team">$0</span></div>
            <div class="kpi-row highlight"><span>å¹´åº¦ç¸½åˆ</span><span class="val-tot" id="y1_total">$0</span></div>
        </div>
        <div class="kpi-card" style="border-color: rgba(56, 189, 248, 0.5);">
            <div class="kpi-title"><span style="color:var(--color-personal)">ç¬¬ 5 å¹´ (Growth)</span><i class="fas fa-chart-line text-primary opacity-50"></i></div>
            <div class="kpi-row"><span>å€‹äººç´¯ç©</span><span class="val-p" id="y5_self">$0</span></div>
            <div class="kpi-row"><span>çµ„ç¹”ç´¯ç©</span><span class="val-t" id="y5_team">$0</span></div>
            <div class="kpi-row highlight"><span>ç´¯ç©ç¸½åˆ</span><span class="val-tot" id="y5_total">$0</span></div>
        </div>
        <div class="kpi-card">
            <div class="kpi-title"><span>ç¬¬ 10 å¹´ (Legacy)</span><i class="fas fa-crown text-warning opacity-50"></i></div>
            <div class="kpi-row"><span>å€‹äººç´¯ç©</span><span class="val-p" id="y10_self">$0</span></div>
            <div class="kpi-row"><span>çµ„ç¹”ç´¯ç©</span><span class="val-t" id="y10_team">$0</span></div>
            <div class="kpi-row highlight"><span>ç´¯ç©ç¸½åˆ</span><span class="val-tot" id="y10_total">$0</span></div>
        </div>
    </div>

    <div class="mb-3">
        <h4 class="fw-bold text-white m-0">åˆ¶åº¦æ§“æ¡¿åˆ†æ (SYSTEM LEVERAGE)</h4>
        <span class="text-sub small">æ¯”è¼ƒã€Œæ¨è¼”åˆä¸€ã€èˆ‡ã€Œæ¨è¼”åˆ†é–‹ã€ä¹‹çµ„ç¹”æ•ˆç›Š</span>
    </div>

    <div class="leverage-box">
        <div class="lev-grid">
            <div class="lev-col">
                <div class="lev-title">ğŸ›¡ï¸ æ¨è¼”åˆä¸€ (Strategy A)</div>
                <div class="lev-value" id="lev_val_A">$0</div>
                <div class="small text-success">
                    <i class="fas fa-check me-1"></i>100% å®Œæ•´åˆ©å·®<br>
                    <i class="fas fa-check me-1"></i>äº«æœ‰ä»£æ•¸èˆ‡çºŒæœŸ
                </div>
            </div>
            <div class="lev-circle">
                <div class="lev-x" id="lev_multiplier">0.0x</div>
                <div class="small text-white mt-2">æ§“æ¡¿å€æ•¸</div>
            </div>
            <div class="lev-col">
                <div class="lev-title">ğŸ¤ æ¨è¼”åˆ†é–‹ (Strategy B)</div>
                <div class="lev-value" id="lev_val_B">$0</div>
                <div class="small text-sub">
                    <i class="fas fa-info-circle me-1"></i>30% æ¨è–¦åˆ©å·®<br>
                    <i class="fas fa-info-circle me-1"></i>äº«æœ‰ä»£æ•¸çé‡‘
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-section">
        <div class="panel">
            <div style="height: 400px; width: 100%;">
                <canvas id="mainChart"></canvas>
            </div>
        </div>
        <div class="panel">
            <table class="table-custom">
                <thead>
                    <tr>
                        <th class="text-center">å¹´</th>
                        <th>å€‹äººæ”¶å…¥</th>
                        <th>åœ˜éšŠåˆ©æ½¤</th>
                        <th>å¹´åº¦ç¸½å’Œ</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let myChart = null;

    function calculate() {
        const strategyInput = document.getElementById('strategySelect').value;
        const mixRatio = parseFloat(document.getElementById('productMix').value); 
        
        const myRankVal = Number(document.getElementById('myRank').value);
        const subRankVal = Number(document.getElementById('subRank').value);
        
        const selfSalesRaw = Number(document.getElementById('sliderSales').value);
        const teamSalesRaw = Number(document.getElementById('sliderTeamSales').value);
        const recruits = Number(document.getElementById('sliderRecruits').value);
        const retentionRaw = Number(document.getElementById('sliderRetention').value);

        const selfTFYB = selfSalesRaw * 10000;
        const teamTFYB = teamSalesRaw * 10000;
        const retentionRate = retentionRaw / 100;

        document.getElementById('valSales').innerText = `$${selfTFYB.toLocaleString()}`;
        document.getElementById('valTeamSales').innerText = `$${teamTFYB.toLocaleString()}`;
        document.getElementById('valRecruits').innerText = `${recruits} äºº`;
        document.getElementById('valRetention').innerText = `${retentionRaw}%`;
        
        // --- é‚è¼¯åˆ¤æ–· ---
        let isSplitForced = false;
        let effectiveStrategy = strategyInput;
        
        if (subRankVal >= myRankVal) {
            isSplitForced = true;
            effectiveStrategy = 'B';
            document.getElementById('splitAlert').style.display = 'block';
        } else {
            document.getElementById('splitAlert').style.display = 'none';
        }

        const shortRatio = 1 - mixRatio;
        const gen1Rate = (mixRatio * 0.04) + (shortRatio * 0.02);

        let spreadRate = 0;
        if (isSplitForced) {
            spreadRate = Math.max(0, 0.92 - subRankVal);
        } else {
            spreadRate = Math.max(0, myRankVal - subRankVal);
        }

        function runSimulation(strat, isForced) {
            let accSelf = 0, accTeam = 0;
            let result = [];

            for (let year = 1; year <= 10; year++) {
                let selfFYC = selfTFYB * myRankVal;
                let selfRenew = 0;
                
                if (year > 1 && mixRatio > 0) {
                    for (let p = 1; p < year; p++) {
                        if (year - p <= 6) { 
                            selfRenew += (selfTFYB * mixRatio * 0.10 * Math.pow(retentionRate, year - p));
                        }
                    }
                }
                let currentSelf = selfFYC + selfRenew;
                accSelf += currentSelf;

                let teamVolume = teamTFYB * recruits;
                let spreadBonus = teamVolume * spreadRate;

                if (strat === 'B' || isForced) {
                    spreadBonus = spreadBonus * 0.30;
                }

                let genBonus = teamVolume * gen1Rate;

                let teamRenew = 0;
                if (strat === 'A' && !isForced && year > 1 && mixRatio > 0) {
                    for (let p = 1; p < year; p++) {
                        if (year - p <= 6) {
                            teamRenew += (teamVolume * mixRatio * 0.02 * Math.pow(retentionRate, year - p));
                        }
                    }
                }

                let currentTeam = spreadBonus + genBonus + teamRenew;
                accTeam += currentTeam;

                result.push({
                    year: year,
                    self: currentSelf,
                    team: currentTeam,
                    total: currentSelf + currentTeam,
                    accSelf: accSelf,
                    accTeam: accTeam,
                    accTotal: accSelf + accTeam
                });
            }
            return result;
        }

        const dataCurrent = runSimulation(effectiveStrategy, isSplitForced);
        
        let dataA, dataB;
        if (subRankVal >= myRankVal) {
            dataA = [{ accTeam: 0 },{},{},{},{},{},{},{},{},{ accTeam: 0 }];
            dataB = runSimulation('B', true); 
        } else {
            dataA = runSimulation('A', false);
            dataB = runSimulation('B', false);
        }

        const fmt = (n) => '$' + Math.round(n).toLocaleString();
        
        document.getElementById('y1_self').innerText = fmt(dataCurrent[0].self);
        document.getElementById('y1_team').innerText = fmt(dataCurrent[0].team);
        document.getElementById('y1_total').innerText = fmt(dataCurrent[0].total);
        document.getElementById('y5_self').innerText = fmt(dataCurrent[4].accSelf);
        document.getElementById('y5_team').innerText = fmt(dataCurrent[4].accTeam);
        document.getElementById('y5_total').innerText = fmt(dataCurrent[4].accTotal);
        document.getElementById('y10_self').innerText = fmt(dataCurrent[9].accSelf);
        document.getElementById('y10_team').innerText = fmt(dataCurrent[9].accTeam);
        document.getElementById('y10_total').innerText = fmt(dataCurrent[9].accTotal);

        const totalA = dataA[9].accTeam;
        const totalB = dataB[9].accTeam;
        
        document.getElementById('lev_val_A').innerText = fmt(totalA);
        document.getElementById('lev_val_B').innerText = fmt(totalB);
        
        let multiplier = 0;
        if (totalB > 0) multiplier = (totalA / totalB).toFixed(1);
        else if (totalA > 0) multiplier = "âˆ";
        else multiplier = "0.0";
        document.getElementById('lev_multiplier').innerText = multiplier + "x";

        // --- ğŸ¤– AI å»ºè­°ç”Ÿæˆ ---
        updateAIAdvice(effectiveStrategy, mixRatio, recruits, isSplitForced, subRankVal);

        updateTableChart(dataCurrent);
    }

    function updateAIAdvice(strategy, mix, recruits, isForced, subRank) {
        let advice = "";
        
        if (isForced) {
            advice = "ç›®å‰è™•æ–¼å¹³éš/ä½å¢é«˜ç‹€æ…‹ï¼Œåˆ©æ½¤åƒ…å‰©30%ä¸”ç„¡çºŒæœŸã€‚å»ºè­°å„ªå…ˆæå‡å€‹äººæ¥­ç¸¾é”æ¨™æ™‰å‡ï¼Œæ‹‰é–‹èˆ‡ä¸‹å±¬çš„è·ç´šå·®è·ï¼Œæ‰èƒ½äº«å—å®Œæ•´è¼”å°åˆ©æ½¤èˆ‡çµ„ç¹”çºŒæœŸè³‡ç”¢ã€‚";
        } else if (strategy === 'B') {
            advice = "æ¨è¼”åˆ†é–‹é›–è¼•é¬†ï¼Œä½†é•·æœŸå°‡æå¤±70%çµ„ç¹”åˆ©ç›Šèˆ‡é¾å¤§çºŒæœŸè³‡ç”¢ã€‚è‹¥æ‚¨å…·å‚™è¼”å°èƒ½åŠ›ï¼Œå¼·çƒˆå»ºè­°è½‰ç‚ºæ¨è¼”åˆä¸€ï¼Œå°‡è¢«å‹•æ”¶å…¥æœ€å¤§åŒ–ï¼Œç‚ºé€€ä¼‘åšæº–å‚™ã€‚";
        } else if (mix < 0.5) {
            advice = "çŸ­å¹´æœŸå•†å“é›–æœ‰çˆ†ç™¼åŠ›ï¼Œä½†ç¼ºä¹çºŒæœŸå †ç–Šæ•ˆæ‡‰ã€‚å»ºè­°æé«˜é•·å¹´æœŸä½”æ¯”è‡³50%ä»¥ä¸Šï¼Œåˆ©ç”¨æ™‚é–“è¤‡åˆ©æ‰“é€ ç©©å®šçš„é€€ä¼‘ç¾é‡‘æµï¼Œé€™æ‰æ˜¯ä¿éšªäº‹æ¥­çš„ç²¾éš¨ã€‚";
        } else if (recruits < 3) {
            advice = "ç›®å‰çš„çµ„ç¹”æ§“æ¡¿æ•ˆç›Šè¼ƒä½ã€‚æ˜“å®‰ç¶²åˆ¶åº¦å„ªå‹¢åœ¨æ–¼ä»£æ•¸çé‡‘èˆ‡çµ„ç¹”åˆ©å·®ï¼Œå»ºè­°æ“´å¤§å¢å“¡è‡³5äººä»¥ä¸Šï¼Œå•Ÿå‹•çµ„ç¹”å€å¢æ•ˆæ‡‰ï¼Œå‰µé€ æŒ‡æ•¸ç´šçš„æ”¶å…¥æˆé•·ã€‚";
        } else {
            advice = "æ‚¨æ­£è™•æ–¼è³‡ç”¢ç´¯ç©çš„é»ƒé‡‘æœŸï¼ç¶­æŒé«˜çºŒä¿ç‡å°‡æ˜¯æœªä¾†çš„é—œéµã€‚å»ºè­°æŒçºŒåŸ¹é¤Šæ ¸å¿ƒå¹¹éƒ¨æ™‰å‡ï¼Œåˆ©ç”¨ä»£æ•¸çé‡‘çš„æ·±åº¦å„ªå‹¢ï¼Œæ‰“é€ ä¸€æ”¯æ°¸çºŒç¶“ç‡Ÿçš„é‹¼éµåœ˜éšŠã€‚";
        }
        
        document.getElementById('aiAdvice').innerText = advice;
    }

    function updateTableChart(data) {
        let html = '';
        data.forEach(d => {
            html += `<tr>
                <td>Y${d.year}</td>
                <td style="color:var(--color-personal)">$${Math.round(d.self).toLocaleString()}</td>
                <td style="color:var(--color-team)">$${Math.round(d.team).toLocaleString()}</td>
                <td style="color:white; font-weight:bold">$${Math.round(d.total).toLocaleString()}</td>
            </tr>`;
        });
        document.getElementById('tableBody').innerHTML = html;

        const ctx = document.getElementById('mainChart').getContext('2d');
        if(myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => 'Y'+d.year),
                datasets: [
                    {
                        label: 'ç¸½è³‡ç”¢', data: data.map(d => d.accTotal),
                        borderColor: '#ffffff', backgroundColor: 'rgba(255,255,255,0.05)',
                        borderWidth: 3, fill: true, tension: 0.3, pointRadius: 3
                    },
                    {
                        label: 'åœ˜éšŠåˆ©æ½¤', data: data.map(d => d.accTeam),
                        borderColor: '#fb923c', borderWidth: 2, borderDash: [5,5],
                        fill: false, tension: 0.3, pointRadius: 2
                    },
                    {
                        label: 'å€‹äººæ”¶å…¥', data: data.map(d => d.accSelf),
                        borderColor: '#38bdf8', borderWidth: 2, borderDash: [2,2],
                        fill: false, tension: 0.3, pointRadius: 2
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: { 
                        mode:'index', intersect:false, backgroundColor:'#1e293b',
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                if (context.parsed.y !== null) { label += '$' + Math.round(context.parsed.y).toLocaleString(); }
                                return label;
                            }
                        }
                    } 
                },
                scales: {
                    x: { grid:{display:false}, ticks:{color:'#94a3b8'} },
                    y: { 
                        grid:{color:'#334155'}, 
                        ticks:{
                            color:'#94a3b8',
                            callback: function(value, index, values) {
                                return '$' + value.toLocaleString();
                            }
                        } 
                    }
                }
            }
        });
    }

    window.onload = function() {
        setTimeout(calculate, 100);
    };
</script>

</body>
</html>